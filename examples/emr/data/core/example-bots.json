{
  "resourceType": "Bundle",
  "type": "transaction",
  "entry": [
    {
      "fullUrl": "urn:uuid:51a14c81-6617-4252-841f-9ba1152e7c32",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/typescript",
        "data": "aW1wb3J0IHsgQm90RXZlbnQsIGdldFF1ZXN0aW9ubmFpcmVBbnN3ZXJzLCBMT0lOQywgTWVkcGx1bUNsaWVudCB9IGZyb20gJ0BtZWRwbHVtL2NvcmUnOwppbXBvcnQgewogIEJ1bmRsZSwKICBDbGluaWNhbEltcHJlc3Npb24sCiAgQ29kZWFibGVDb25jZXB0LAogIENvbmRpdGlvbiwKICBFbmNvdW50ZXIsCiAgT2JzZXJ2YXRpb24sCiAgUHJhY3RpdGlvbmVyLAogIFF1ZXN0aW9ubmFpcmVSZXNwb25zZSwKICBRdWVzdGlvbm5haXJlUmVzcG9uc2VJdGVtQW5zd2VyLAogIFJlZmVyZW5jZSwKfSBmcm9tICdAbWVkcGx1bS9maGlydHlwZXMnOwppbXBvcnQgeyBjcmVhdGVCdW5kbGUsIGNyZWF0ZUNsaW5pY2FsSW1wcmVzc2lvbiwgY3JlYXRlQ29uZGl0aW9ucywgY3JlYXRlT2JzZXJ2YXRpb25zIH0gZnJvbSAnLi9jaGFydGluZy11dGlscyc7CmltcG9ydCB7IGNhbGN1bGF0ZUJNSSB9IGZyb20gJy4vb2JzZXJ2YXRpb24tdXRpbHMnOwoKZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIobWVkcGx1bTogTWVkcGx1bUNsaWVudCwgZXZlbnQ6IEJvdEV2ZW50PFF1ZXN0aW9ubmFpcmVSZXNwb25zZT4pOiBQcm9taXNlPEJ1bmRsZT4gewogIC8vIFBhcnNlIHRoZSBhbnN3ZXJzIGZyb20gdGhlIFF1ZXN0aW9ubmFpcmVSZXNwb25zZQogIGNvbnN0IHJlc3BvbnNlID0gZXZlbnQuaW5wdXQ7CiAgY29uc3QgYW5zd2VycyA9IGdldFF1ZXN0aW9ubmFpcmVBbnN3ZXJzKHJlc3BvbnNlKTsKICAvLyBHZXQgdGhlIGxpbmtlZCBlbmNvdW50ZXIgYW5kIHRoZSB1c2VyIHdobyBpbml0aWF0ZWQgdGhlIGJvdAogIGNvbnN0IGVuY291bnRlciA9IGF3YWl0IG1lZHBsdW0ucmVhZFJlZmVyZW5jZShyZXNwb25zZS5lbmNvdW50ZXIgYXMgUmVmZXJlbmNlPEVuY291bnRlcj4pOwogIGNvbnN0IHVzZXIgPSBtZWRwbHVtLmdldFByb2ZpbGUoKSBhcyBQcmFjdGl0aW9uZXI7CgogIC8vIFJlYXNvbiBmb3IgdmlzaXQgaXMgYSByZXF1aXJlZCBhbnN3ZXIsIHNvIGlmIGl0IGlzIG1pc3NpbmcgdGhyb3cgYW4gZXJyb3IKICBpZiAoIWFuc3dlcnNbJ3JlYXNvbi1mb3ItdmlzaXQnXT8udmFsdWVDb2RpbmcpIHsKICAgIHRocm93IG5ldyBFcnJvcignTXVzdCBwcm92aWRlIGEgcmVhc29uIGZvciB0aGUgdmlzaXQnKTsKICB9CgogIGNvbnN0IGRhdGUgPSBhbnN3ZXJzWydkYXRlJ10udmFsdWVEYXRlVGltZSBhcyBzdHJpbmc7CgogIC8vIFBhcnNlIHRoZSBhbnN3ZXJzIGludG8gbW9yZSBlYXNpbHkgdXNhYmxlIG9iamVjdHMKICBjb25zdCBvYnNlcnZhdGlvbkRhdGE6IFJlY29yZDxzdHJpbmcsIFF1ZXN0aW9ubmFpcmVSZXNwb25zZUl0ZW1BbnN3ZXI+ID0gewogICAgaGVpZ2h0OiBhbnN3ZXJzWydoZWlnaHQnXSwKICAgIHdlaWdodDogYW5zd2Vyc1snd2VpZ2h0J10sCiAgICBob3RGbGFzaDogYW5zd2Vyc1snaG90LWZsYXNoZXMnXSwKICAgIG1vb2RTd2luZ3M6IGFuc3dlcnNbJ21vb2Qtc3dpbmdzJ10sCiAgICB2YWdpbmFsRHJ5bmVzczogYW5zd2Vyc1sndmFnaW5hbC1kcnluZXNzJ10sCiAgICBzbGVlcERpc3R1cmJhbmNlOiBhbnN3ZXJzWydzbGVlcC1kaXN0dXJiYW5jZSddLAogICAgc2VsZlJlcG9ydGVkSGlzdG9yeTogYW5zd2Vyc1snc2VsZi1yZXBvcnRlZC1oaXN0b3J5J10sCiAgICBzeXN0b2xpYzogYW5zd2Vyc1snc3lzdG9saWMnXSwKICAgIGRpYXN0b2xpYzogYW5zd2Vyc1snZGlhc3RvbGljJ10sCiAgfTsKCiAgaWYgKG9ic2VydmF0aW9uRGF0YS5oZWlnaHQgJiYgb2JzZXJ2YXRpb25EYXRhLndlaWdodCkgewogICAgb2JzZXJ2YXRpb25EYXRhLmJtaSA9IGNhbGN1bGF0ZUJNSShvYnNlcnZhdGlvbkRhdGEuaGVpZ2h0LnZhbHVlUXVhbnRpdHksIG9ic2VydmF0aW9uRGF0YS53ZWlnaHQudmFsdWVRdWFudGl0eSk7CiAgfQoKICBjb25zdCBhZGRUb1Byb2JsZW1MaXN0ID0gYW5zd2Vyc1sncHJvYmxlbS1saXN0J10/LnZhbHVlQm9vbGVhbiA/PyBmYWxzZTsKCiAgY29uc3QgcGFydGlhbENvbmRpdGlvbjogUGFydGlhbDxDb25kaXRpb24+ID0gewogICAgcmVzb3VyY2VUeXBlOiAnQ29uZGl0aW9uJywKICAgIGNvZGU6IGFuc3dlcnNbJ3JlYXNvbi1mb3ItdmlzaXQnXS52YWx1ZUNvZGluZywKICB9OwoKICBjb25zdCBub3RlID0gYW5zd2Vyc1snYXNzZXNzbWVudCddPy52YWx1ZVN0cmluZzsKCiAgLy8gVGFrZSB0aGUgb2JqZWN0cyBhbmQgY3JlYXRlIGZ1bGwgcmVzb3VyY2VzIG9mIGVhY2ggdHlwZQogIGNvbnN0IG9ic2VydmF0aW9ucyA9IGNyZWF0ZU9ic2VydmF0aW9ucyhvYnNlcnZhdGlvbkRhdGEsIGdlbmVyYWxDb2RlcywgZW5jb3VudGVyLCB1c2VyLCByZXNwb25zZSwgZGF0ZSk7CiAgY29uc3QgY29uZGl0aW9ucyA9IGNyZWF0ZUNvbmRpdGlvbnMocGFydGlhbENvbmRpdGlvbiwgZW5jb3VudGVyLCB1c2VyLCBhZGRUb1Byb2JsZW1MaXN0KTsKICBjb25zdCBjbGluaWNhbEltcHJlc3Npb25zID0gY3JlYXRlQ2xpbmljYWxJbXByZXNzaW9uKGVuY291bnRlciwgdXNlciwgbm90ZSk7CgogIC8vIENyZWF0ZSBhbiBhcnJheSBvZiBhbGwgcmVzb3VyY2VzCiAgY29uc3QgcmVzb3VyY2VzOiAoQ29uZGl0aW9uIHwgT2JzZXJ2YXRpb24gfCBDbGluaWNhbEltcHJlc3Npb24pW10gPSBbLi4ub2JzZXJ2YXRpb25zLCAuLi5jb25kaXRpb25zXTsKICBpZiAoY2xpbmljYWxJbXByZXNzaW9ucykgewogICAgcmVzb3VyY2VzLnB1c2goY2xpbmljYWxJbXByZXNzaW9ucyk7CiAgfQoKICBjb25zdCBidW5kbGUgPSBjcmVhdGVCdW5kbGUocmVzb3VyY2VzKTsKCiAgLy8gRXhlY3V0ZSB0aGUgYmF0Y2ggdG8gY3JlYXRlIGFsbCByZXNvdXJjZXMgYXQgb25jZQogIGNvbnN0IHJlc3BvbnNlQnVuZGxlID0gYXdhaXQgbWVkcGx1bS5leGVjdXRlQmF0Y2goYnVuZGxlKTsKICByZXR1cm4gcmVzcG9uc2VCdW5kbGU7Cn0KCmV4cG9ydCBjb25zdCBnZW5lcmFsQ29kZXM6IFJlY29yZDxzdHJpbmcsIENvZGVhYmxlQ29uY2VwdD4gPSB7CiAgaGVpZ2h0OiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICc4MzAyLTInLCBzeXN0ZW06IExPSU5DLCBkaXNwbGF5OiAnQm9keSBoZWlnaHQnIH1dLAogIH0sCiAgd2VpZ2h0OiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICcyOTQ2My03Jywgc3lzdGVtOiBMT0lOQywgZGlzcGxheTogJ0JvZHkgd2VpZ2h0JyB9XSwKICB9LAogIGJsb29kUHJlc3N1cmU6IHsKICAgIGNvZGluZzogW3sgY29kZTogJzM1MDk0LTInLCBzeXN0ZW06IExPSU5DLCBkaXNwbGF5OiAnQmxvb2QgcHJlc3N1cmUgcGFuZWwnIH1dLAogIH0sCiAgYm1pOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICczOTE1Ni01Jywgc3lzdGVtOiBMT0lOQywgZGlzcGxheTogJ0JvZHkgTWFzcyBJbmRleCAoQk1JKScgfV0sCiAgfSwKICBob3RGbGFzaDogewogICAgY29kaW5nOiBbeyBjb2RlOiAnNzAzNzYtOScsIHN5c3RlbTogTE9JTkMsIGRpc3BsYXk6ICdJIGhhdmUgaG90IGZsYXNoZXMgaW4gdGhlIGxhc3QgNyBkYXlzJyB9XSwKICB9LAogIG1vb2RTd2luZ3M6IHsKICAgIGNvZGluZzogW3sgY29kZTogJzcwODA1LTcnLCBzeXN0ZW06IExPSU5DLCBkaXNwbGF5OiAnSSBoYXZlIG1vb2Qgc3dpbmdzIGluIHRoZSBsYXN0IDcgZGF5cycgfV0sCiAgfSwKICB2YWdpbmFsRHJ5bmVzczogewogICAgY29kaW5nOiBbeyBjb2RlOiAnNzA4MDItNCcsIHN5c3RlbTogTE9JTkMsIGRpc3BsYXk6ICdJIGhhdmUgdmFnaW5hbCBkcnluZXNzIGluIHRoZSBsYXN0IDcgZGF5cycgfV0sCiAgfSwKICBzbGVlcERpc3R1cmJhbmNlOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICc3NzcxMi04Jywgc3lzdGVtOiBMT0lOQywgZGlzcGxheTogJ1NsZWVwIGRpc3R1cmJhbmNlIGluZGljYXRvciBpbiB0aGUgbGFzdCB3ZWVrJyB9XSwKICB9LAp9Owo="
      }
    },
    {
      "fullUrl": "urn:uuid:c6c9b2a1-5225-4a9c-b91c-03582f828253",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/javascript",
        "data": "InVzZSBzdHJpY3QiOwp2YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Owp2YXIgX19nZXRPd25Qcm9wRGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CnZhciBfX2dldE93blByb3BOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwp2YXIgX19oYXNPd25Qcm9wID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIF9fZXhwb3J0ID0gKHRhcmdldCwgYWxsKSA9PiB7CiAgZm9yICh2YXIgbmFtZSBpbiBhbGwpCiAgICBfX2RlZlByb3AodGFyZ2V0LCBuYW1lLCB7IGdldDogYWxsW25hbWVdLCBlbnVtZXJhYmxlOiB0cnVlIH0pOwp9Owp2YXIgX19jb3B5UHJvcHMgPSAodG8sIGZyb20sIGV4Y2VwdCwgZGVzYykgPT4gewogIGlmIChmcm9tICYmIHR5cGVvZiBmcm9tID09PSAib2JqZWN0IiB8fCB0eXBlb2YgZnJvbSA9PT0gImZ1bmN0aW9uIikgewogICAgZm9yIChsZXQga2V5IG9mIF9fZ2V0T3duUHJvcE5hbWVzKGZyb20pKQogICAgICBpZiAoIV9faGFzT3duUHJvcC5jYWxsKHRvLCBrZXkpICYmIGtleSAhPT0gZXhjZXB0KQogICAgICAgIF9fZGVmUHJvcCh0bywga2V5LCB7IGdldDogKCkgPT4gZnJvbVtrZXldLCBlbnVtZXJhYmxlOiAhKGRlc2MgPSBfX2dldE93blByb3BEZXNjKGZyb20sIGtleSkpIHx8IGRlc2MuZW51bWVyYWJsZSB9KTsKICB9CiAgcmV0dXJuIHRvOwp9Owp2YXIgX190b0NvbW1vbkpTID0gKG1vZCkgPT4gX19jb3B5UHJvcHMoX19kZWZQcm9wKHt9LCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIG1vZCk7CgovLyBzcmMvYm90cy9jb3JlL2dlbmVyYWwtZW5jb3VudGVyLW5vdGUudHMKdmFyIGdlbmVyYWxfZW5jb3VudGVyX25vdGVfZXhwb3J0cyA9IHt9OwpfX2V4cG9ydChnZW5lcmFsX2VuY291bnRlcl9ub3RlX2V4cG9ydHMsIHsKICBnZW5lcmFsQ29kZXM6ICgpID0+IGdlbmVyYWxDb2RlcywKICBoYW5kbGVyOiAoKSA9PiBoYW5kbGVyCn0pOwptb2R1bGUuZXhwb3J0cyA9IF9fdG9Db21tb25KUyhnZW5lcmFsX2VuY291bnRlcl9ub3RlX2V4cG9ydHMpOwp2YXIgaW1wb3J0X2NvcmUyID0gcmVxdWlyZSgiQG1lZHBsdW0vY29yZSIpOwoKLy8gc3JjL2JvdHMvY29yZS9jaGFydGluZy11dGlscy50cwp2YXIgaW1wb3J0X2NvcmUgPSByZXF1aXJlKCJAbWVkcGx1bS9jb3JlIik7CnZhciBpbXBvcnRfY3J5cHRvID0gcmVxdWlyZSgiY3J5cHRvIik7CmZ1bmN0aW9uIGNyZWF0ZU9ic2VydmF0aW9ucyhvYnNlcnZhdGlvbkRhdGEsIGNvZGVzLCBlbmNvdW50ZXIsIHVzZXIsIHJlc3BvbnNlLCBkYXRlKSB7CiAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgY29uc3QgYmxvb2RQcmVzc3VyZSA9IHsKICAgIHN5c3RvbGljOiBvYnNlcnZhdGlvbkRhdGEuc3lzdG9saWM/LnZhbHVlUXVhbnRpdHksCiAgICBkaWFzdG9saWM6IG9ic2VydmF0aW9uRGF0YS5kaWFzdG9saWM/LnZhbHVlUXVhbnRpdHkKICB9OwogIGNvbnN0IGJsb29kUHJlc3N1cmVPYnNlcnZhdGlvbiA9IGNyZWF0ZUJsb29kUHJlc3N1cmVPYnNlcnZhdGlvbihibG9vZFByZXNzdXJlLCBlbmNvdW50ZXIsIHVzZXIsIGRhdGUsIHJlc3BvbnNlKTsKICBpZiAoYmxvb2RQcmVzc3VyZU9ic2VydmF0aW9uKSB7CiAgICBvYnNlcnZhdGlvbnMucHVzaChibG9vZFByZXNzdXJlT2JzZXJ2YXRpb24pOwogIH0KICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhvYnNlcnZhdGlvbkRhdGEpKSB7CiAgICBpZiAoIXZhbHVlIHx8IGtleSA9PT0gInN5c3RvbGljIiB8fCBrZXkgPT09ICJkaWFzdG9saWMiKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKGtleSA9PT0gInNlbGZSZXBvcnRlZEhpc3RvcnkiICYmICF2YWx1ZT8udmFsdWVTdHJpbmcpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHJlcG9ydGVkIGhpc3RvcnkiKTsKICAgIH0KICAgIGNvbnN0IGNvZGUgPSBrZXkgPT09ICJzZWxmUmVwb3J0ZWRIaXN0b3J5IiA/IHNlbGZSZXBvcnRlZEhpc3RvcnlbdmFsdWUudmFsdWVTdHJpbmddIDogY29kZXNba2V5XTsKICAgIGlmICghY29kZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIGNvZGUgcHJvdmlkZWQiKTsKICAgIH0KICAgIGNvbnN0IHJlc291cmNlID0gewogICAgICBjb2RlLAogICAgICAuLi5vYnNlcnZhdGlvbkRhdGFba2V5XQogICAgfTsKICAgIGNvbnN0IG9ic2VydmF0aW9uID0gewogICAgICAuLi5yZXNvdXJjZSwKICAgICAgcmVzb3VyY2VUeXBlOiAiT2JzZXJ2YXRpb24iLAogICAgICBjb2RlLAogICAgICBzdGF0dXM6ICJmaW5hbCIsCiAgICAgIHN1YmplY3Q6IGVuY291bnRlci5zdWJqZWN0LAogICAgICBwZXJmb3JtZXI6IFt7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfV0sCiAgICAgIGVuY291bnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKGVuY291bnRlcikgfSwKICAgICAgZWZmZWN0aXZlRGF0ZVRpbWU6IGRhdGUsCiAgICAgIGRlcml2ZWRGcm9tOiBbeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHJlc3BvbnNlKSB9XQogICAgfTsKICAgIG9ic2VydmF0aW9ucy5wdXNoKG9ic2VydmF0aW9uKTsKICB9CiAgcmV0dXJuIG9ic2VydmF0aW9uczsKfQpmdW5jdGlvbiBjcmVhdGVCbG9vZFByZXNzdXJlT2JzZXJ2YXRpb24oYmxvb2RQcmVzc3VyZSwgZW5jb3VudGVyLCB1c2VyLCBkYXRlLCByZXNwb25zZSkgewogIGNvbnN0IHsgc3lzdG9saWMsIGRpYXN0b2xpYyB9ID0gYmxvb2RQcmVzc3VyZTsKICBpZiAoIXN5c3RvbGljICYmICFkaWFzdG9saWMpIHsKICAgIHJldHVybiB2b2lkIDA7CiAgfQogIGNvbnN0IGNvbXBvbmVudCA9IGhhbmRsZUJsb29kUHJlc3N1cmUoc3lzdG9saWMsIGRpYXN0b2xpYyk7CiAgY29uc3QgYmxvb2RQcmVzc3VyZU9ic2VydmF0aW9uID0gewogICAgcmVzb3VyY2VUeXBlOiAiT2JzZXJ2YXRpb24iLAogICAgc3RhdHVzOiAiZmluYWwiLAogICAgY29kZTogewogICAgICBjb2Rpbmc6IFt7IGNvZGU6ICIzNTA5NC0yIiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJCbG9vZCBwcmVzc3VyZSBwYW5lbCIgfV0KICAgIH0sCiAgICBzdWJqZWN0OiBlbmNvdW50ZXIuc3ViamVjdCwKICAgIHBlcmZvcm1lcjogW3sgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKSh1c2VyKSB9XSwKICAgIGVuY291bnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKGVuY291bnRlcikgfSwKICAgIGVmZmVjdGl2ZURhdGVUaW1lOiBkYXRlLAogICAgZGVyaXZlZEZyb206IFt7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykocmVzcG9uc2UpIH1dLAogICAgY29tcG9uZW50CiAgfTsKICByZXR1cm4gYmxvb2RQcmVzc3VyZU9ic2VydmF0aW9uOwp9CmZ1bmN0aW9uIGhhbmRsZUJsb29kUHJlc3N1cmUoc3lzdG9saWMsIGRpYXN0b2xpYykgewogIGNvbnN0IGNvbXBvbmVudHMgPSBbXTsKICBpZiAoZGlhc3RvbGljKSB7CiAgICBjb21wb25lbnRzLnB1c2goewogICAgICBjb2RlOiB7IGNvZGluZzogW3sgY29kZTogIjg0NjItNCIsIHN5c3RlbTogImh0dHA6Ly9sb2luYy5vcmciLCBkaXNwbGF5OiAiRGlhc3RvbGljIGJsb29kIHByZXNzdXJlIiB9XSB9LAogICAgICB2YWx1ZVF1YW50aXR5OiBkaWFzdG9saWMKICAgIH0pOwogIH0KICBpZiAoc3lzdG9saWMpIHsKICAgIGNvbXBvbmVudHMucHVzaCh7CiAgICAgIGNvZGU6IHsgY29kaW5nOiBbeyBjb2RlOiAiODQ4MC02Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJTeXN0b2xpYyBibG9vZCBwcmVzc3VyZSIgfV0gfSwKICAgICAgdmFsdWVRdWFudGl0eTogc3lzdG9saWMKICAgIH0pOwogIH0KICByZXR1cm4gY29tcG9uZW50czsKfQpmdW5jdGlvbiBjcmVhdGVDb25kaXRpb25zKHBhcnRpYWxDb25kaXRpb24sIGVuY291bnRlciwgdXNlciwgcHJvYmxlbUxpc3QpIHsKICBjb25zdCBjb25kaXRpb25zID0gW107CiAgY29uc3QgZW5jb3VudGVyRGlhZ25vc2lzID0gewogICAgLi4ucGFydGlhbENvbmRpdGlvbiwKICAgIHJlc291cmNlVHlwZTogIkNvbmRpdGlvbiIsCiAgICBzdWJqZWN0OiBlbmNvdW50ZXIuc3ViamVjdCwKICAgIGVuY291bnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKGVuY291bnRlcikgfSwKICAgIHJlY29yZGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfSwKICAgIGFzc2VydGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfSwKICAgIGNhdGVnb3J5OiBbCiAgICAgIHsKICAgICAgICBjb2Rpbmc6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9WYWx1ZVNldC9jb25kaXRpb24tY2F0ZWdvcnkiLAogICAgICAgICAgICBjb2RlOiAiZW5jb3VudGVyLWRpYWdub3NpcyIsCiAgICAgICAgICAgIGRpc3BsYXk6ICJFbmNvdW50ZXIgRGlhZ25vc2lzIgogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfQogICAgXQogIH07CiAgY29uZGl0aW9ucy5wdXNoKGVuY291bnRlckRpYWdub3Npcyk7CiAgaWYgKHByb2JsZW1MaXN0KSB7CiAgICBjb25kaXRpb25zLnB1c2goewogICAgICAuLi5wYXJ0aWFsQ29uZGl0aW9uLAogICAgICByZXNvdXJjZVR5cGU6ICJDb25kaXRpb24iLAogICAgICBzdWJqZWN0OiBlbmNvdW50ZXIuc3ViamVjdCwKICAgICAgZW5jb3VudGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykoZW5jb3VudGVyKSB9LAogICAgICByZWNvcmRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHVzZXIpIH0sCiAgICAgIGFzc2VydGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfSwKICAgICAgY2F0ZWdvcnk6IFsKICAgICAgICB7CiAgICAgICAgICBjb2Rpbmc6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvVmFsdWVTZXQvY29uZGl0aW9uLWNhdGVnb3J5IiwKICAgICAgICAgICAgICBjb2RlOiAicHJvYmxlbS1saXN0LWl0ZW0iLAogICAgICAgICAgICAgIGRpc3BsYXk6ICJQcm9ibGVtIExpc3QgSXRlbSIKICAgICAgICAgICAgfQogICAgICAgICAgXQogICAgICAgIH0KICAgICAgXQogICAgfSk7CiAgfQogIHJldHVybiBjb25kaXRpb25zOwp9CmZ1bmN0aW9uIGNyZWF0ZUNsaW5pY2FsSW1wcmVzc2lvbihlbmNvdW50ZXIsIHVzZXIsIG5vdGUpIHsKICBpZiAoIW5vdGUpIHsKICAgIHJldHVybiB2b2lkIDA7CiAgfQogIGNvbnN0IGNsaW5pY2FsSW1wcmVzc2lvbiA9IHsKICAgIHJlc291cmNlVHlwZTogIkNsaW5pY2FsSW1wcmVzc2lvbiIsCiAgICBzdGF0dXM6ICJpbi1wcm9ncmVzcyIsCiAgICBzdWJqZWN0OiBlbmNvdW50ZXIuc3ViamVjdCwKICAgIGVuY291bnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKGVuY291bnRlcikgfSwKICAgIGFzc2Vzc29yOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfSwKICAgIG5vdGU6IFt7IHRleHQ6IG5vdGUgfV0KICB9OwogIHJldHVybiBjbGluaWNhbEltcHJlc3Npb247Cn0KZnVuY3Rpb24gY3JlYXRlQnVuZGxlKHJlc291cmNlcykgewogIGNvbnN0IGJ1bmRsZSA9IHsKICAgIHJlc291cmNlVHlwZTogIkJ1bmRsZSIsCiAgICB0eXBlOiAidHJhbnNhY3Rpb24iCiAgfTsKICBjb25zdCBlbnRyaWVzID0gcmVzb3VyY2VzLm1hcCgocmVzb3VyY2UpID0+IHsKICAgIGNvbnN0IGVudHJ5ID0gewogICAgICBmdWxsVXJsOiBgdXJuOnV1aWQ6JHsoMCwgaW1wb3J0X2NyeXB0by5yYW5kb21VVUlEKSgpfWAsCiAgICAgIHJlcXVlc3Q6IHsgbWV0aG9kOiAiUFVUIiwgdXJsOiBnZXRVcHNlcnRVcmwocmVzb3VyY2UpIH0sCiAgICAgIHJlc291cmNlCiAgICB9OwogICAgcmV0dXJuIGVudHJ5OwogIH0pOwogIGJ1bmRsZS5lbnRyeSA9IGVudHJpZXM7CiAgcmV0dXJuIGJ1bmRsZTsKfQpmdW5jdGlvbiBnZXRVcHNlcnRVcmwocmVzb3VyY2UpIHsKICBpZiAocmVzb3VyY2UucmVzb3VyY2VUeXBlID09PSAiT2JzZXJ2YXRpb24iKSB7CiAgICBjb25zdCBjb2RlID0gcmVzb3VyY2UuY29kZTsKICAgIGlmICghY29kZS5jb2Rpbmc/LlswXS5jb2RlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gY29kZSBwcm92aWRlZCIpOwogICAgfQogICAgaWYgKCFyZXNvdXJjZS5lbmNvdW50ZXIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBsaW5rZWQgZW5jb3VudGVyIik7CiAgICB9CiAgICBjb25zdCB1cmwgPSBgT2JzZXJ2YXRpb24/ZW5jb3VudGVyPSR7KDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykocmVzb3VyY2UuZW5jb3VudGVyKX0mY29kZT0ke2NvZGUuY29kaW5nPy5bMF0uY29kZX1gOwogICAgcmV0dXJuIHVybDsKICB9IGVsc2UgaWYgKHJlc291cmNlLnJlc291cmNlVHlwZSA9PT0gIkNvbmRpdGlvbiIpIHsKICAgIGNvbnN0IGNvZGUgPSByZXNvdXJjZS5jb2RlOwogICAgaWYgKCFjb2RlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gY29kZSBwcm92aWRlZCIpOwogICAgfQogICAgaWYgKCFyZXNvdXJjZS5lbmNvdW50ZXIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBsaW5rZWQgZW5jb3VudGVyIik7CiAgICB9CiAgICByZXR1cm4gYENvbmRpdGlvbj9lbmNvdW50ZXI9JHsoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKShyZXNvdXJjZS5lbmNvdW50ZXIpfSZjb2RlPSR7Y29kZS5jb2Rpbmc/LlswXS5jb2RlfWA7CiAgfSBlbHNlIGlmIChyZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT09ICJDbGluaWNhbEltcHJlc3Npb24iKSB7CiAgICBpZiAoIXJlc291cmNlLmVuY291bnRlcikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIGxpbmtlZCBlbmNvdW50ZXIiKTsKICAgIH0KICAgIHJldHVybiBgQ2xpbmljYWxJbXByZXNzaW9uP2VuY291bnRlcj0keygwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHJlc291cmNlLmVuY291bnRlcil9YDsKICB9IGVsc2UgewogICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHJlc291cmNlIHR5cGUiKTsKICB9Cn0KdmFyIHNlbGZSZXBvcnRlZEhpc3RvcnkgPSB7CiAgIkJsb29kIGNsb3RzIjogewogICAgY29kaW5nOiBbCiAgICAgIHsKICAgICAgICBjb2RlOiAiSTc0LjkiLAogICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCIsCiAgICAgICAgZGlzcGxheTogIkVtYm9saXNtIGFuZCB0aHJvbWJvc2lzIG9mIHVuc3BlY2lmaWVkIGFydGVyeSIKICAgICAgfQogICAgXQogIH0sCiAgU3Ryb2tlOiB7CiAgICBjb2Rpbmc6IFsKICAgICAgewogICAgICAgIGNvZGU6ICJJNjMuOSIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiQ2VyZWJyYWwgaW5mYXJjdGlvbiwgdW5zcGVjaWZpZWQiCiAgICAgIH0KICAgIF0KICB9LAogICJCcmVhc3QgY2FuY2VyIjogewogICAgY29kaW5nOiBbCiAgICAgIHsKICAgICAgICBjb2RlOiAiRDA1LjEwIiwKICAgICAgICBzeXN0ZW06ICJodHRwOi8vaGw3Lm9yZy9maGlyL3NpZC9pY2QtMTAiLAogICAgICAgIGRpc3BsYXk6ICJJbnRyYWR1Y3RhbCBjYXJjaW5vbWEgaW4gc2l0dSBvZiB1bnNwZWNpZmllZCBicmVhc3QiCiAgICAgIH0KICAgIF0KICB9LAogICJFbmRvbWV0cmlhbCBjYW5jZXIiOiB7CiAgICBjb2Rpbmc6IFsKICAgICAgewogICAgICAgIGNvZGU6ICJDNTQuMSIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiTWFsaWduYW50IG5lb3BsYXNtIG9mIGVuZG9tZXRyaXVtIgogICAgICB9CiAgICBdCiAgfSwKICAiSXJyZWd1bGFyIGJsZWVkaW5nIjogewogICAgY29kaW5nOiBbCiAgICAgIHsKICAgICAgICBjb2RlOiAiTjkyLjEiLAogICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCIsCiAgICAgICAgZGlzcGxheTogIkV4Y2Vzc2l2ZSBhbmQgZnJlcXVlbnQgbWVuc3RydWF0aW9uIHdpdGggaXJyZWd1bGFyIGN5Y2xlIgogICAgICB9CiAgICBdCiAgfSwKICAiQk1JID4gMzAiOiB7CiAgICBjb2Rpbmc6IFsKICAgICAgewogICAgICAgIGNvZGU6ICJFNjYuOSIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiT2Jlc2l0eSwgdW5zcGVjaWZpZWQiCiAgICAgIH0KICAgIF0KICB9Cn07CgovLyBzcmMvYm90cy9jb3JlL29ic2VydmF0aW9uLXV0aWxzLnRzCmZ1bmN0aW9uIGNhbGN1bGF0ZUJNSShoZWlnaHQsIHdlaWdodCkgewogIGlmICghaGVpZ2h0Py52YWx1ZSB8fCAhd2VpZ2h0Py52YWx1ZSkgewogICAgdGhyb3cgbmV3IEVycm9yKCJBbGwgdmFsdWVzIG11c3QgYmUgcHJvdmlkZWQiKTsKICB9CiAgY29uc3QgaGVpZ2h0TSA9IGdldEhlaWdodEluTWV0ZXJzKGhlaWdodCk7CiAgY29uc3Qgd2VpZ2h0S2cgPSBnZXRXZWlnaHRJbktpbG9ncmFtcyh3ZWlnaHQpOwogIGNvbnN0IGJtaSA9IE1hdGgucm91bmQod2VpZ2h0S2cgLyBoZWlnaHRNICoqIDIgKiAxMCkgLyAxMDsKICByZXR1cm4gewogICAgdmFsdWU6IGJtaSwKICAgIHVuaXQ6ICJrZy9tXjIiCiAgfTsKfQpmdW5jdGlvbiBnZXRXZWlnaHRJbktpbG9ncmFtcyh3ZWlnaHQpIHsKICBpZiAoIXdlaWdodC51bml0KSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIHVuaXQgZGVmaW5lZCIpOwogIH0KICBjb25zdCB1bml0ID0gd2VpZ2h0LnVuaXQ7CiAgY29uc3Qgd2VpZ2h0VmFsID0gd2VpZ2h0LnZhbHVlOwogIHN3aXRjaCAodW5pdCkgewogICAgY2FzZSAibGIiOgogICAgICByZXR1cm4gd2VpZ2h0VmFsIC8gMi4yOwogICAgY2FzZSAia2ciOgogICAgICByZXR1cm4gd2VpZ2h0VmFsOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIHVuaXQuIFBsZWFzZSBwcm92aWRlIHdlaWdodCBpbiBvbmUgb2YgdGhlIGZvbGxvd2luZyB1bml0czogUG91bmRzIG9yIGtpbG9ncmFtcy4iKTsKICB9Cn0KZnVuY3Rpb24gZ2V0SGVpZ2h0SW5NZXRlcnMoaGVpZ2h0KSB7CiAgaWYgKCFoZWlnaHQudW5pdCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJObyB1bml0IGRlZmluZWQiKTsKICB9CiAgY29uc3QgdW5pdCA9IGhlaWdodC51bml0OwogIGNvbnN0IGhlaWdodFZhbCA9IGhlaWdodC52YWx1ZTsKICBzd2l0Y2ggKHVuaXQpIHsKICAgIGNhc2UgImluIjoKICAgICAgcmV0dXJuIGhlaWdodFZhbCAqIDIuNTQgLyAxMDA7CiAgICBjYXNlICJmdCI6CiAgICAgIHJldHVybiBoZWlnaHRWYWwgKiAxMiAqIDIuNTQgLyAxMDA7CiAgICBjYXNlICJjbSI6CiAgICAgIHJldHVybiBoZWlnaHRWYWwgLyAxMDA7CiAgICBjYXNlICJtIjoKICAgICAgcmV0dXJuIGhlaWdodFZhbDsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAiVW5rbm93biB1bml0LiBQbGVhc2UgcHJvdmlkZSBoZWlnaHQgaW4gb25lIG9mIHRoZSBmb2xsb3dpbmcgdW5pdHM6IEluY2hlcywgZmVldCwgY2VudGltZXRlcnMsIG9yIG1ldGVycy4iCiAgICAgICk7CiAgfQp9CgovLyBzcmMvYm90cy9jb3JlL2dlbmVyYWwtZW5jb3VudGVyLW5vdGUudHMKYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihtZWRwbHVtLCBldmVudCkgewogIGNvbnN0IHJlc3BvbnNlID0gZXZlbnQuaW5wdXQ7CiAgY29uc3QgYW5zd2VycyA9ICgwLCBpbXBvcnRfY29yZTIuZ2V0UXVlc3Rpb25uYWlyZUFuc3dlcnMpKHJlc3BvbnNlKTsKICBjb25zdCBlbmNvdW50ZXIgPSBhd2FpdCBtZWRwbHVtLnJlYWRSZWZlcmVuY2UocmVzcG9uc2UuZW5jb3VudGVyKTsKICBjb25zdCB1c2VyID0gbWVkcGx1bS5nZXRQcm9maWxlKCk7CiAgaWYgKCFhbnN3ZXJzWyJyZWFzb24tZm9yLXZpc2l0Il0/LnZhbHVlQ29kaW5nKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk11c3QgcHJvdmlkZSBhIHJlYXNvbiBmb3IgdGhlIHZpc2l0Iik7CiAgfQogIGNvbnN0IGRhdGUgPSBhbnN3ZXJzWyJkYXRlIl0udmFsdWVEYXRlVGltZTsKICBjb25zdCBvYnNlcnZhdGlvbkRhdGEgPSB7CiAgICBoZWlnaHQ6IGFuc3dlcnNbImhlaWdodCJdLAogICAgd2VpZ2h0OiBhbnN3ZXJzWyJ3ZWlnaHQiXSwKICAgIGhvdEZsYXNoOiBhbnN3ZXJzWyJob3QtZmxhc2hlcyJdLAogICAgbW9vZFN3aW5nczogYW5zd2Vyc1sibW9vZC1zd2luZ3MiXSwKICAgIHZhZ2luYWxEcnluZXNzOiBhbnN3ZXJzWyJ2YWdpbmFsLWRyeW5lc3MiXSwKICAgIHNsZWVwRGlzdHVyYmFuY2U6IGFuc3dlcnNbInNsZWVwLWRpc3R1cmJhbmNlIl0sCiAgICBzZWxmUmVwb3J0ZWRIaXN0b3J5OiBhbnN3ZXJzWyJzZWxmLXJlcG9ydGVkLWhpc3RvcnkiXSwKICAgIHN5c3RvbGljOiBhbnN3ZXJzWyJzeXN0b2xpYyJdLAogICAgZGlhc3RvbGljOiBhbnN3ZXJzWyJkaWFzdG9saWMiXQogIH07CiAgaWYgKG9ic2VydmF0aW9uRGF0YS5oZWlnaHQgJiYgb2JzZXJ2YXRpb25EYXRhLndlaWdodCkgewogICAgb2JzZXJ2YXRpb25EYXRhLmJtaSA9IGNhbGN1bGF0ZUJNSShvYnNlcnZhdGlvbkRhdGEuaGVpZ2h0LnZhbHVlUXVhbnRpdHksIG9ic2VydmF0aW9uRGF0YS53ZWlnaHQudmFsdWVRdWFudGl0eSk7CiAgfQogIGNvbnN0IGFkZFRvUHJvYmxlbUxpc3QgPSBhbnN3ZXJzWyJwcm9ibGVtLWxpc3QiXT8udmFsdWVCb29sZWFuID8/IGZhbHNlOwogIGNvbnN0IHBhcnRpYWxDb25kaXRpb24gPSB7CiAgICByZXNvdXJjZVR5cGU6ICJDb25kaXRpb24iLAogICAgY29kZTogYW5zd2Vyc1sicmVhc29uLWZvci12aXNpdCJdLnZhbHVlQ29kaW5nCiAgfTsKICBjb25zdCBub3RlID0gYW5zd2Vyc1siYXNzZXNzbWVudCJdPy52YWx1ZVN0cmluZzsKICBjb25zdCBvYnNlcnZhdGlvbnMgPSBjcmVhdGVPYnNlcnZhdGlvbnMob2JzZXJ2YXRpb25EYXRhLCBnZW5lcmFsQ29kZXMsIGVuY291bnRlciwgdXNlciwgcmVzcG9uc2UsIGRhdGUpOwogIGNvbnN0IGNvbmRpdGlvbnMgPSBjcmVhdGVDb25kaXRpb25zKHBhcnRpYWxDb25kaXRpb24sIGVuY291bnRlciwgdXNlciwgYWRkVG9Qcm9ibGVtTGlzdCk7CiAgY29uc3QgY2xpbmljYWxJbXByZXNzaW9ucyA9IGNyZWF0ZUNsaW5pY2FsSW1wcmVzc2lvbihlbmNvdW50ZXIsIHVzZXIsIG5vdGUpOwogIGNvbnN0IHJlc291cmNlcyA9IFsuLi5vYnNlcnZhdGlvbnMsIC4uLmNvbmRpdGlvbnNdOwogIGlmIChjbGluaWNhbEltcHJlc3Npb25zKSB7CiAgICByZXNvdXJjZXMucHVzaChjbGluaWNhbEltcHJlc3Npb25zKTsKICB9CiAgY29uc3QgYnVuZGxlID0gY3JlYXRlQnVuZGxlKHJlc291cmNlcyk7CiAgY29uc3QgcmVzcG9uc2VCdW5kbGUgPSBhd2FpdCBtZWRwbHVtLmV4ZWN1dGVCYXRjaChidW5kbGUpOwogIHJldHVybiByZXNwb25zZUJ1bmRsZTsKfQp2YXIgZ2VuZXJhbENvZGVzID0gewogIGhlaWdodDogewogICAgY29kaW5nOiBbeyBjb2RlOiAiODMwMi0yIiwgc3lzdGVtOiBpbXBvcnRfY29yZTIuTE9JTkMsIGRpc3BsYXk6ICJCb2R5IGhlaWdodCIgfV0KICB9LAogIHdlaWdodDogewogICAgY29kaW5nOiBbeyBjb2RlOiAiMjk0NjMtNyIsIHN5c3RlbTogaW1wb3J0X2NvcmUyLkxPSU5DLCBkaXNwbGF5OiAiQm9keSB3ZWlnaHQiIH1dCiAgfSwKICBibG9vZFByZXNzdXJlOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICIzNTA5NC0yIiwgc3lzdGVtOiBpbXBvcnRfY29yZTIuTE9JTkMsIGRpc3BsYXk6ICJCbG9vZCBwcmVzc3VyZSBwYW5lbCIgfV0KICB9LAogIGJtaTogewogICAgY29kaW5nOiBbeyBjb2RlOiAiMzkxNTYtNSIsIHN5c3RlbTogaW1wb3J0X2NvcmUyLkxPSU5DLCBkaXNwbGF5OiAiQm9keSBNYXNzIEluZGV4IChCTUkpIiB9XQogIH0sCiAgaG90Rmxhc2g6IHsKICAgIGNvZGluZzogW3sgY29kZTogIjcwMzc2LTkiLCBzeXN0ZW06IGltcG9ydF9jb3JlMi5MT0lOQywgZGlzcGxheTogIkkgaGF2ZSBob3QgZmxhc2hlcyBpbiB0aGUgbGFzdCA3IGRheXMiIH1dCiAgfSwKICBtb29kU3dpbmdzOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICI3MDgwNS03Iiwgc3lzdGVtOiBpbXBvcnRfY29yZTIuTE9JTkMsIGRpc3BsYXk6ICJJIGhhdmUgbW9vZCBzd2luZ3MgaW4gdGhlIGxhc3QgNyBkYXlzIiB9XQogIH0sCiAgdmFnaW5hbERyeW5lc3M6IHsKICAgIGNvZGluZzogW3sgY29kZTogIjcwODAyLTQiLCBzeXN0ZW06IGltcG9ydF9jb3JlMi5MT0lOQywgZGlzcGxheTogIkkgaGF2ZSB2YWdpbmFsIGRyeW5lc3MgaW4gdGhlIGxhc3QgNyBkYXlzIiB9XQogIH0sCiAgc2xlZXBEaXN0dXJiYW5jZTogewogICAgY29kaW5nOiBbeyBjb2RlOiAiNzc3MTItOCIsIHN5c3RlbTogaW1wb3J0X2NvcmUyLkxPSU5DLCBkaXNwbGF5OiAiU2xlZXAgZGlzdHVyYmFuY2UgaW5kaWNhdG9yIGluIHRoZSBsYXN0IHdlZWsiIH1dCiAgfQp9OwovLyBBbm5vdGF0ZSB0aGUgQ29tbW9uSlMgZXhwb3J0IG5hbWVzIGZvciBFU00gaW1wb3J0IGluIG5vZGU6CjAgJiYgKG1vZHVsZS5leHBvcnRzID0gewogIGdlbmVyYWxDb2RlcywKICBoYW5kbGVyCn0pOwpPYmplY3QuYXNzaWduKGV4cG9ydHMsIG1vZHVsZS5leHBvcnRzKTsK"
      }
    },
    {
      "request": {
        "method": "PUT",
        "url": "$bot-general-encounter-note-reference"
      },
      "resource": {
        "resourceType": "Bot",
        "id": "$bot-general-encounter-note-id",
        "name": "general-encounter-note",
        "runtimeVersion": "awslambda",
        "sourceCode": {
          "contentType": "text/typescript",
          "url": "urn:uuid:51a14c81-6617-4252-841f-9ba1152e7c32"
        },
        "executableCode": {
          "contentType": "text/javascript",
          "url": "urn:uuid:c6c9b2a1-5225-4a9c-b91c-03582f828253"
        }
      }
    },
    {
      "request": {
        "url": "Subscription",
        "method": "POST",
        "ifNoneExist": "url=$bot-general-encounter-note-reference"
      },
      "resource": {
        "resourceType": "Subscription",
        "status": "active",
        "reason": "general-encounter-note",
        "channel": {
          "endpoint": "$bot-general-encounter-note-reference",
          "type": "rest-hook"
        },
        "criteria": "QuestionnaireResponse?questionnaire=$encounter-note"
      }
    },
    {
      "fullUrl": "urn:uuid:618598f7-692d-481a-ac4f-ce1486197e82",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/typescript",
        "data": "aW1wb3J0IHsgQm90RXZlbnQsIGdldFF1ZXN0aW9ubmFpcmVBbnN3ZXJzLCBMT0lOQywgTWVkcGx1bUNsaWVudCwgU05PTUVEIH0gZnJvbSAnQG1lZHBsdW0vY29yZSc7CmltcG9ydCB7CiAgQnVuZGxlLAogIENsaW5pY2FsSW1wcmVzc2lvbiwKICBDb2RlYWJsZUNvbmNlcHQsCiAgQ29uZGl0aW9uLAogIEVuY291bnRlciwKICBPYnNlcnZhdGlvbiwKICBQcmFjdGl0aW9uZXIsCiAgUXVlc3Rpb25uYWlyZVJlc3BvbnNlLAogIFF1ZXN0aW9ubmFpcmVSZXNwb25zZUl0ZW1BbnN3ZXIsCiAgUmVmZXJlbmNlLAp9IGZyb20gJ0BtZWRwbHVtL2ZoaXJ0eXBlcyc7CmltcG9ydCB7IGNyZWF0ZUJ1bmRsZSwgY3JlYXRlQ2xpbmljYWxJbXByZXNzaW9uLCBjcmVhdGVDb25kaXRpb25zLCBjcmVhdGVPYnNlcnZhdGlvbnMgfSBmcm9tICcuL2NoYXJ0aW5nLXV0aWxzJzsKaW1wb3J0IHsgY2FsY3VsYXRlQk1JIH0gZnJvbSAnLi9vYnNlcnZhdGlvbi11dGlscyc7CgpleHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihtZWRwbHVtOiBNZWRwbHVtQ2xpZW50LCBldmVudDogQm90RXZlbnQ8UXVlc3Rpb25uYWlyZVJlc3BvbnNlPik6IFByb21pc2U8QnVuZGxlPiB7CiAgLy8gUGFyc2UgdGhlIGFuc3dlcnMgZnJvbSB0aGUgUXVlc3Rpb25uYWlyZVJlc3BvbnNlCiAgY29uc3QgcmVzcG9uc2UgPSBldmVudC5pbnB1dDsKICBjb25zdCBhbnN3ZXJzID0gZ2V0UXVlc3Rpb25uYWlyZUFuc3dlcnMocmVzcG9uc2UpOwogIC8vIEdldCB0aGUgbGlua2VkIGVuY291bnRlciBhbmQgdGhlIHVzZXIgd2hvIGluaXRpYXRlZCB0aGUgYm90CiAgY29uc3QgZW5jb3VudGVyID0gYXdhaXQgbWVkcGx1bS5yZWFkUmVmZXJlbmNlKHJlc3BvbnNlLmVuY291bnRlciBhcyBSZWZlcmVuY2U8RW5jb3VudGVyPik7CiAgY29uc3QgdXNlciA9IG1lZHBsdW0uZ2V0UHJvZmlsZSgpIGFzIFByYWN0aXRpb25lcjsKCiAgLy8gVGhlIHJlYXNvbiBmb3IgdmlzaXQgcXVlc3Rpb24gaXMgcmVxdWlyZWQuIElmIGl0IGlzIG5vdCBpbmNsdWRlZCwgd2UgdGhyb3cgYW4gZXJyb3IKICBpZiAoIWFuc3dlcnNbJ3JlYXNvbi1mb3ItdmlzaXQnXSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdNdXN0IHByb3ZpZGUgYSByZWFzb24gZm9yIHRoZSB2aXNpdCcpOwogIH0KCiAgY29uc3QgZGF0ZSA9IGFuc3dlcnNbJ2RhdGUnXS52YWx1ZURhdGVUaW1lIGFzIHN0cmluZzsKCiAgLy8gUGFyc2UgdGhlIGFuc3dlcnMgaW50byBtb3JlIGVhc2lseSB1c2FibGUgb2JqZWN0cwogIGNvbnN0IG9ic2VydmF0aW9uRGF0YTogUmVjb3JkPHN0cmluZywgUXVlc3Rpb25uYWlyZVJlc3BvbnNlSXRlbUFuc3dlcj4gPSB7CiAgICBncmF2aWRhOiBhbnN3ZXJzWydncmF2aWRhJ10sCiAgICBwYXJhOiBhbnN3ZXJzWydwYXJhJ10sCiAgICBnZXN0YXRpb25hbERheXM6IGFuc3dlcnNbJ2dlc3RhdGlvbmFsLWFnZS1kYXlzJ10sCiAgICBnZXN0YXRpb25hbFdlZWtzOiBhbnN3ZXJzWydnZXN0YXRpb25hbC1hZ2Utd2Vla3MnXSwKICAgIGhlaWdodDogYW5zd2Vyc1snaGVpZ2h0J10sCiAgICB3ZWlnaHQ6IGFuc3dlcnNbJ3dlaWdodCddLAogICAgdG90YWxXZWlnaHRHYWluOiBhbnN3ZXJzWyd0b3RhbC13ZWlnaHQtZ2FpbiddLAogICAgc3lzdG9saWM6IGFuc3dlcnNbJ3N5c3RvbGljJ10sCiAgICBkaWFzdG9saWM6IGFuc3dlcnNbJ2RpYXN0b2xpYyddLAogIH07CgogIGlmIChvYnNlcnZhdGlvbkRhdGEuaGVpZ2h0ICYmIG9ic2VydmF0aW9uRGF0YS53ZWlnaHQpIHsKICAgIG9ic2VydmF0aW9uRGF0YS5ibWkgPSBjYWxjdWxhdGVCTUkob2JzZXJ2YXRpb25EYXRhLmhlaWdodC52YWx1ZVF1YW50aXR5LCBvYnNlcnZhdGlvbkRhdGEud2VpZ2h0LnZhbHVlUXVhbnRpdHkpOwogIH0KCiAgY29uc3QgYWRkVG9Qcm9ibGVtTGlzdCA9IGFuc3dlcnNbJ3Byb2JsZW0tbGlzdCddPy52YWx1ZUJvb2xlYW4gPz8gZmFsc2U7CgogIGNvbnN0IHBhcnRpYWxDb25kaXRpb246IFBhcnRpYWw8Q29uZGl0aW9uPiA9IHsKICAgIHJlc291cmNlVHlwZTogJ0NvbmRpdGlvbicsCiAgICBjb2RlOiBhbnN3ZXJzWydyZWFzb24tZm9yLXZpc2l0J10udmFsdWVDb2RpbmcsCiAgfTsKCiAgY29uc3Qgbm90ZSA9IGFuc3dlcnNbJ2Fzc2Vzc21lbnQnXT8udmFsdWVTdHJpbmc7CgogIC8vIFRha2UgdGhlIGFib3ZlIG9iamVjdHMgYW5kIGNyZWF0ZSByZXNvdXJjZXMgZm9yIGVhY2ggdHlwZQogIGNvbnN0IG9ic2VydmF0aW9ucyA9IGNyZWF0ZU9ic2VydmF0aW9ucyhvYnNlcnZhdGlvbkRhdGEsIG9ic3RldHJpY0NvZGVzLCBlbmNvdW50ZXIsIHVzZXIsIHJlc3BvbnNlLCBkYXRlKTsKICBjb25zdCBjb25kaXRpb25zID0gY3JlYXRlQ29uZGl0aW9ucyhwYXJ0aWFsQ29uZGl0aW9uLCBlbmNvdW50ZXIsIHVzZXIsIGFkZFRvUHJvYmxlbUxpc3QpOwogIGNvbnN0IGNsaW5pY2FsSW1wcmVzc2lvbnMgPSBjcmVhdGVDbGluaWNhbEltcHJlc3Npb24oZW5jb3VudGVyLCB1c2VyLCBub3RlKTsKCiAgLy8gQ3JlYXRlIGFuIGVudHJ5IGFycmF5IG9mIGFsbCB0aGUgYnVuZGxlIGVudHJpZXMKICBjb25zdCByZXNvdXJjZXM6IChPYnNlcnZhdGlvbiB8IENvbmRpdGlvbiB8IENsaW5pY2FsSW1wcmVzc2lvbilbXSA9IFsuLi5vYnNlcnZhdGlvbnMsIC4uLmNvbmRpdGlvbnNdOwogIGlmIChjbGluaWNhbEltcHJlc3Npb25zKSB7CiAgICByZXNvdXJjZXMucHVzaChjbGluaWNhbEltcHJlc3Npb25zKTsKICB9CgogIC8vIEJ1aWxkIHRoZSBidW5kbGUKICBjb25zdCBidW5kbGUgPSBjcmVhdGVCdW5kbGUocmVzb3VyY2VzKTsKCiAgLy8gRXhlY3V0ZSB0aGUgYnVuZGxlIGFzIGEgYmF0Y2ggdG8gY3JlYXRlIGFsbCBvZiB0aGUgT2JzZXJ2YXRpb24sIENvbmRpdGlvbiwgYW5kIENsaW5pY2FsSW1wcmVzc2lvbiByZXNvdXJjZXMgYXQgb25jZQogIGNvbnN0IHJlc3BvbnNlQnVuZGxlID0gYXdhaXQgbWVkcGx1bS5leGVjdXRlQmF0Y2goYnVuZGxlKTsKICByZXR1cm4gcmVzcG9uc2VCdW5kbGU7Cn0KCmNvbnN0IG9ic3RldHJpY0NvZGVzOiBSZWNvcmQ8c3RyaW5nLCBDb2RlYWJsZUNvbmNlcHQ+ID0gewogIGhlaWdodDogewogICAgY29kaW5nOiBbeyBjb2RlOiAnODMwMi0yJywgc3lzdGVtOiBMT0lOQywgZGlzcGxheTogJ0JvZHkgaGVpZ2h0JyB9XSwKICB9LAogIHdlaWdodDogewogICAgY29kaW5nOiBbeyBjb2RlOiAnMjk0NjMtNycsIHN5c3RlbTogTE9JTkMsIGRpc3BsYXk6ICdCb2R5IHdlaWdodCcgfV0sCiAgfSwKICBibG9vZFByZXNzdXJlOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICczNTA5NC0yJywgc3lzdGVtOiBMT0lOQywgZGlzcGxheTogJ0Jsb29kIHByZXNzdXJlIHBhbmVsJyB9XSwKICB9LAogIGJtaTogewogICAgY29kaW5nOiBbeyBjb2RlOiAnMzkxNTYtNScsIHN5c3RlbTogTE9JTkMsIGRpc3BsYXk6ICdCb2R5IE1hc3MgSW5kZXggKEJNSSknIH1dLAogIH0sCiAgZ3JhdmlkYTogewogICAgY29kaW5nOiBbeyBjb2RlOiAnMTYxNzMyMDA2Jywgc3lzdGVtOiBTTk9NRUQsIGRpc3BsYXk6ICdHcmF2aWRhJyB9XSwKICB9LAogIHBhcmE6IHsKICAgIGNvZGluZzogW3sgY29kZTogJzExODIxMjAwMCcsIHN5c3RlbTogU05PTUVELCBkaXNwbGF5OiAnUGFyaXR5IGZpbmRpbmcnIH1dLAogIH0sCiAgZ2VzdGF0aW9uYWxEYXlzOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICc0OTA1Mi00Jywgc3lzdGVtOiBMT0lOQywgZGlzcGxheTogJ0dlc3RhdGlvbmFsIGFnZSBpbiBkYXlzJyB9XSwKICB9LAogIGdlc3RhdGlvbmFsV2Vla3M6IHsKICAgIGNvZGluZzogW3sgY29kZTogJzQ5MDUxLTYnLCBzeXN0ZW06IExPSU5DLCBkaXNwbGF5OiAnR2VzdGF0aW9uYWwgYWdlIGluIHdlZWtzJyB9XSwKICB9LAogIHRvdGFsV2VpZ2h0R2FpbjogewogICAgY29kaW5nOiBbeyBjb2RlOiAnNTYwNzgtOScsIHN5c3RlbTogTE9JTkMsIGRpc3BsYXk6ICdXZWlnaHQgZ2FpbiBbTWFzc10gLS1kdXJpbmcgY3VycmVudCBwcmVnbmFuY3knIH1dLAogIH0sCn07Cg=="
      }
    },
    {
      "fullUrl": "urn:uuid:ffac9cf1-3b10-448f-a54d-d966c886aac1",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/javascript",
        "data": "InVzZSBzdHJpY3QiOwp2YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Owp2YXIgX19nZXRPd25Qcm9wRGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CnZhciBfX2dldE93blByb3BOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwp2YXIgX19oYXNPd25Qcm9wID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIF9fZXhwb3J0ID0gKHRhcmdldCwgYWxsKSA9PiB7CiAgZm9yICh2YXIgbmFtZSBpbiBhbGwpCiAgICBfX2RlZlByb3AodGFyZ2V0LCBuYW1lLCB7IGdldDogYWxsW25hbWVdLCBlbnVtZXJhYmxlOiB0cnVlIH0pOwp9Owp2YXIgX19jb3B5UHJvcHMgPSAodG8sIGZyb20sIGV4Y2VwdCwgZGVzYykgPT4gewogIGlmIChmcm9tICYmIHR5cGVvZiBmcm9tID09PSAib2JqZWN0IiB8fCB0eXBlb2YgZnJvbSA9PT0gImZ1bmN0aW9uIikgewogICAgZm9yIChsZXQga2V5IG9mIF9fZ2V0T3duUHJvcE5hbWVzKGZyb20pKQogICAgICBpZiAoIV9faGFzT3duUHJvcC5jYWxsKHRvLCBrZXkpICYmIGtleSAhPT0gZXhjZXB0KQogICAgICAgIF9fZGVmUHJvcCh0bywga2V5LCB7IGdldDogKCkgPT4gZnJvbVtrZXldLCBlbnVtZXJhYmxlOiAhKGRlc2MgPSBfX2dldE93blByb3BEZXNjKGZyb20sIGtleSkpIHx8IGRlc2MuZW51bWVyYWJsZSB9KTsKICB9CiAgcmV0dXJuIHRvOwp9Owp2YXIgX190b0NvbW1vbkpTID0gKG1vZCkgPT4gX19jb3B5UHJvcHMoX19kZWZQcm9wKHt9LCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIG1vZCk7CgovLyBzcmMvYm90cy9jb3JlL29ic3RldHJpYy1lbmNvdW50ZXItbm90ZS50cwp2YXIgb2JzdGV0cmljX2VuY291bnRlcl9ub3RlX2V4cG9ydHMgPSB7fTsKX19leHBvcnQob2JzdGV0cmljX2VuY291bnRlcl9ub3RlX2V4cG9ydHMsIHsKICBoYW5kbGVyOiAoKSA9PiBoYW5kbGVyCn0pOwptb2R1bGUuZXhwb3J0cyA9IF9fdG9Db21tb25KUyhvYnN0ZXRyaWNfZW5jb3VudGVyX25vdGVfZXhwb3J0cyk7CnZhciBpbXBvcnRfY29yZTIgPSByZXF1aXJlKCJAbWVkcGx1bS9jb3JlIik7CgovLyBzcmMvYm90cy9jb3JlL2NoYXJ0aW5nLXV0aWxzLnRzCnZhciBpbXBvcnRfY29yZSA9IHJlcXVpcmUoIkBtZWRwbHVtL2NvcmUiKTsKdmFyIGltcG9ydF9jcnlwdG8gPSByZXF1aXJlKCJjcnlwdG8iKTsKZnVuY3Rpb24gY3JlYXRlT2JzZXJ2YXRpb25zKG9ic2VydmF0aW9uRGF0YSwgY29kZXMsIGVuY291bnRlciwgdXNlciwgcmVzcG9uc2UsIGRhdGUpIHsKICBjb25zdCBvYnNlcnZhdGlvbnMgPSBbXTsKICBjb25zdCBibG9vZFByZXNzdXJlID0gewogICAgc3lzdG9saWM6IG9ic2VydmF0aW9uRGF0YS5zeXN0b2xpYz8udmFsdWVRdWFudGl0eSwKICAgIGRpYXN0b2xpYzogb2JzZXJ2YXRpb25EYXRhLmRpYXN0b2xpYz8udmFsdWVRdWFudGl0eQogIH07CiAgY29uc3QgYmxvb2RQcmVzc3VyZU9ic2VydmF0aW9uID0gY3JlYXRlQmxvb2RQcmVzc3VyZU9ic2VydmF0aW9uKGJsb29kUHJlc3N1cmUsIGVuY291bnRlciwgdXNlciwgZGF0ZSwgcmVzcG9uc2UpOwogIGlmIChibG9vZFByZXNzdXJlT2JzZXJ2YXRpb24pIHsKICAgIG9ic2VydmF0aW9ucy5wdXNoKGJsb29kUHJlc3N1cmVPYnNlcnZhdGlvbik7CiAgfQogIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKG9ic2VydmF0aW9uRGF0YSkpIHsKICAgIGlmICghdmFsdWUgfHwga2V5ID09PSAic3lzdG9saWMiIHx8IGtleSA9PT0gImRpYXN0b2xpYyIpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBpZiAoa2V5ID09PSAic2VsZlJlcG9ydGVkSGlzdG9yeSIgJiYgIXZhbHVlPy52YWx1ZVN0cmluZykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgcmVwb3J0ZWQgaGlzdG9yeSIpOwogICAgfQogICAgY29uc3QgY29kZSA9IGtleSA9PT0gInNlbGZSZXBvcnRlZEhpc3RvcnkiID8gc2VsZlJlcG9ydGVkSGlzdG9yeVt2YWx1ZS52YWx1ZVN0cmluZ10gOiBjb2Rlc1trZXldOwogICAgaWYgKCFjb2RlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gY29kZSBwcm92aWRlZCIpOwogICAgfQogICAgY29uc3QgcmVzb3VyY2UgPSB7CiAgICAgIGNvZGUsCiAgICAgIC4uLm9ic2VydmF0aW9uRGF0YVtrZXldCiAgICB9OwogICAgY29uc3Qgb2JzZXJ2YXRpb24gPSB7CiAgICAgIC4uLnJlc291cmNlLAogICAgICByZXNvdXJjZVR5cGU6ICJPYnNlcnZhdGlvbiIsCiAgICAgIGNvZGUsCiAgICAgIHN0YXR1czogImZpbmFsIiwKICAgICAgc3ViamVjdDogZW5jb3VudGVyLnN1YmplY3QsCiAgICAgIHBlcmZvcm1lcjogW3sgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKSh1c2VyKSB9XSwKICAgICAgZW5jb3VudGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykoZW5jb3VudGVyKSB9LAogICAgICBlZmZlY3RpdmVEYXRlVGltZTogZGF0ZSwKICAgICAgZGVyaXZlZEZyb206IFt7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykocmVzcG9uc2UpIH1dCiAgICB9OwogICAgb2JzZXJ2YXRpb25zLnB1c2gob2JzZXJ2YXRpb24pOwogIH0KICByZXR1cm4gb2JzZXJ2YXRpb25zOwp9CmZ1bmN0aW9uIGNyZWF0ZUJsb29kUHJlc3N1cmVPYnNlcnZhdGlvbihibG9vZFByZXNzdXJlLCBlbmNvdW50ZXIsIHVzZXIsIGRhdGUsIHJlc3BvbnNlKSB7CiAgY29uc3QgeyBzeXN0b2xpYywgZGlhc3RvbGljIH0gPSBibG9vZFByZXNzdXJlOwogIGlmICghc3lzdG9saWMgJiYgIWRpYXN0b2xpYykgewogICAgcmV0dXJuIHZvaWQgMDsKICB9CiAgY29uc3QgY29tcG9uZW50ID0gaGFuZGxlQmxvb2RQcmVzc3VyZShzeXN0b2xpYywgZGlhc3RvbGljKTsKICBjb25zdCBibG9vZFByZXNzdXJlT2JzZXJ2YXRpb24gPSB7CiAgICByZXNvdXJjZVR5cGU6ICJPYnNlcnZhdGlvbiIsCiAgICBzdGF0dXM6ICJmaW5hbCIsCiAgICBjb2RlOiB7CiAgICAgIGNvZGluZzogW3sgY29kZTogIjM1MDk0LTIiLCBzeXN0ZW06ICJodHRwOi8vbG9pbmMub3JnIiwgZGlzcGxheTogIkJsb29kIHByZXNzdXJlIHBhbmVsIiB9XQogICAgfSwKICAgIHN1YmplY3Q6IGVuY291bnRlci5zdWJqZWN0LAogICAgcGVyZm9ybWVyOiBbeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHVzZXIpIH1dLAogICAgZW5jb3VudGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykoZW5jb3VudGVyKSB9LAogICAgZWZmZWN0aXZlRGF0ZVRpbWU6IGRhdGUsCiAgICBkZXJpdmVkRnJvbTogW3sgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKShyZXNwb25zZSkgfV0sCiAgICBjb21wb25lbnQKICB9OwogIHJldHVybiBibG9vZFByZXNzdXJlT2JzZXJ2YXRpb247Cn0KZnVuY3Rpb24gaGFuZGxlQmxvb2RQcmVzc3VyZShzeXN0b2xpYywgZGlhc3RvbGljKSB7CiAgY29uc3QgY29tcG9uZW50cyA9IFtdOwogIGlmIChkaWFzdG9saWMpIHsKICAgIGNvbXBvbmVudHMucHVzaCh7CiAgICAgIGNvZGU6IHsgY29kaW5nOiBbeyBjb2RlOiAiODQ2Mi00Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJEaWFzdG9saWMgYmxvb2QgcHJlc3N1cmUiIH1dIH0sCiAgICAgIHZhbHVlUXVhbnRpdHk6IGRpYXN0b2xpYwogICAgfSk7CiAgfQogIGlmIChzeXN0b2xpYykgewogICAgY29tcG9uZW50cy5wdXNoKHsKICAgICAgY29kZTogeyBjb2Rpbmc6IFt7IGNvZGU6ICI4NDgwLTYiLCBzeXN0ZW06ICJodHRwOi8vbG9pbmMub3JnIiwgZGlzcGxheTogIlN5c3RvbGljIGJsb29kIHByZXNzdXJlIiB9XSB9LAogICAgICB2YWx1ZVF1YW50aXR5OiBzeXN0b2xpYwogICAgfSk7CiAgfQogIHJldHVybiBjb21wb25lbnRzOwp9CmZ1bmN0aW9uIGNyZWF0ZUNvbmRpdGlvbnMocGFydGlhbENvbmRpdGlvbiwgZW5jb3VudGVyLCB1c2VyLCBwcm9ibGVtTGlzdCkgewogIGNvbnN0IGNvbmRpdGlvbnMgPSBbXTsKICBjb25zdCBlbmNvdW50ZXJEaWFnbm9zaXMgPSB7CiAgICAuLi5wYXJ0aWFsQ29uZGl0aW9uLAogICAgcmVzb3VyY2VUeXBlOiAiQ29uZGl0aW9uIiwKICAgIHN1YmplY3Q6IGVuY291bnRlci5zdWJqZWN0LAogICAgZW5jb3VudGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykoZW5jb3VudGVyKSB9LAogICAgcmVjb3JkZXI6IHsgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKSh1c2VyKSB9LAogICAgYXNzZXJ0ZXI6IHsgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKSh1c2VyKSB9LAogICAgY2F0ZWdvcnk6IFsKICAgICAgewogICAgICAgIGNvZGluZzogWwogICAgICAgICAgewogICAgICAgICAgICBzeXN0ZW06ICJodHRwOi8vaGw3Lm9yZy9maGlyL1ZhbHVlU2V0L2NvbmRpdGlvbi1jYXRlZ29yeSIsCiAgICAgICAgICAgIGNvZGU6ICJlbmNvdW50ZXItZGlhZ25vc2lzIiwKICAgICAgICAgICAgZGlzcGxheTogIkVuY291bnRlciBEaWFnbm9zaXMiCiAgICAgICAgICB9CiAgICAgICAgXQogICAgICB9CiAgICBdCiAgfTsKICBjb25kaXRpb25zLnB1c2goZW5jb3VudGVyRGlhZ25vc2lzKTsKICBpZiAocHJvYmxlbUxpc3QpIHsKICAgIGNvbmRpdGlvbnMucHVzaCh7CiAgICAgIC4uLnBhcnRpYWxDb25kaXRpb24sCiAgICAgIHJlc291cmNlVHlwZTogIkNvbmRpdGlvbiIsCiAgICAgIHN1YmplY3Q6IGVuY291bnRlci5zdWJqZWN0LAogICAgICBlbmNvdW50ZXI6IHsgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKShlbmNvdW50ZXIpIH0sCiAgICAgIHJlY29yZGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfSwKICAgICAgYXNzZXJ0ZXI6IHsgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKSh1c2VyKSB9LAogICAgICBjYXRlZ29yeTogWwogICAgICAgIHsKICAgICAgICAgIGNvZGluZzogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9WYWx1ZVNldC9jb25kaXRpb24tY2F0ZWdvcnkiLAogICAgICAgICAgICAgIGNvZGU6ICJwcm9ibGVtLWxpc3QtaXRlbSIsCiAgICAgICAgICAgICAgZGlzcGxheTogIlByb2JsZW0gTGlzdCBJdGVtIgogICAgICAgICAgICB9CiAgICAgICAgICBdCiAgICAgICAgfQogICAgICBdCiAgICB9KTsKICB9CiAgcmV0dXJuIGNvbmRpdGlvbnM7Cn0KZnVuY3Rpb24gY3JlYXRlQ2xpbmljYWxJbXByZXNzaW9uKGVuY291bnRlciwgdXNlciwgbm90ZSkgewogIGlmICghbm90ZSkgewogICAgcmV0dXJuIHZvaWQgMDsKICB9CiAgY29uc3QgY2xpbmljYWxJbXByZXNzaW9uID0gewogICAgcmVzb3VyY2VUeXBlOiAiQ2xpbmljYWxJbXByZXNzaW9uIiwKICAgIHN0YXR1czogImluLXByb2dyZXNzIiwKICAgIHN1YmplY3Q6IGVuY291bnRlci5zdWJqZWN0LAogICAgZW5jb3VudGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykoZW5jb3VudGVyKSB9LAogICAgYXNzZXNzb3I6IHsgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKSh1c2VyKSB9LAogICAgbm90ZTogW3sgdGV4dDogbm90ZSB9XQogIH07CiAgcmV0dXJuIGNsaW5pY2FsSW1wcmVzc2lvbjsKfQpmdW5jdGlvbiBjcmVhdGVCdW5kbGUocmVzb3VyY2VzKSB7CiAgY29uc3QgYnVuZGxlID0gewogICAgcmVzb3VyY2VUeXBlOiAiQnVuZGxlIiwKICAgIHR5cGU6ICJ0cmFuc2FjdGlvbiIKICB9OwogIGNvbnN0IGVudHJpZXMgPSByZXNvdXJjZXMubWFwKChyZXNvdXJjZSkgPT4gewogICAgY29uc3QgZW50cnkgPSB7CiAgICAgIGZ1bGxVcmw6IGB1cm46dXVpZDokeygwLCBpbXBvcnRfY3J5cHRvLnJhbmRvbVVVSUQpKCl9YCwKICAgICAgcmVxdWVzdDogeyBtZXRob2Q6ICJQVVQiLCB1cmw6IGdldFVwc2VydFVybChyZXNvdXJjZSkgfSwKICAgICAgcmVzb3VyY2UKICAgIH07CiAgICByZXR1cm4gZW50cnk7CiAgfSk7CiAgYnVuZGxlLmVudHJ5ID0gZW50cmllczsKICByZXR1cm4gYnVuZGxlOwp9CmZ1bmN0aW9uIGdldFVwc2VydFVybChyZXNvdXJjZSkgewogIGlmIChyZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT09ICJPYnNlcnZhdGlvbiIpIHsKICAgIGNvbnN0IGNvZGUgPSByZXNvdXJjZS5jb2RlOwogICAgaWYgKCFjb2RlLmNvZGluZz8uWzBdLmNvZGUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBjb2RlIHByb3ZpZGVkIik7CiAgICB9CiAgICBpZiAoIXJlc291cmNlLmVuY291bnRlcikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIGxpbmtlZCBlbmNvdW50ZXIiKTsKICAgIH0KICAgIGNvbnN0IHVybCA9IGBPYnNlcnZhdGlvbj9lbmNvdW50ZXI9JHsoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKShyZXNvdXJjZS5lbmNvdW50ZXIpfSZjb2RlPSR7Y29kZS5jb2Rpbmc/LlswXS5jb2RlfWA7CiAgICByZXR1cm4gdXJsOwogIH0gZWxzZSBpZiAocmVzb3VyY2UucmVzb3VyY2VUeXBlID09PSAiQ29uZGl0aW9uIikgewogICAgY29uc3QgY29kZSA9IHJlc291cmNlLmNvZGU7CiAgICBpZiAoIWNvZGUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBjb2RlIHByb3ZpZGVkIik7CiAgICB9CiAgICBpZiAoIXJlc291cmNlLmVuY291bnRlcikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIGxpbmtlZCBlbmNvdW50ZXIiKTsKICAgIH0KICAgIHJldHVybiBgQ29uZGl0aW9uP2VuY291bnRlcj0keygwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHJlc291cmNlLmVuY291bnRlcil9JmNvZGU9JHtjb2RlLmNvZGluZz8uWzBdLmNvZGV9YDsKICB9IGVsc2UgaWYgKHJlc291cmNlLnJlc291cmNlVHlwZSA9PT0gIkNsaW5pY2FsSW1wcmVzc2lvbiIpIHsKICAgIGlmICghcmVzb3VyY2UuZW5jb3VudGVyKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gbGlua2VkIGVuY291bnRlciIpOwogICAgfQogICAgcmV0dXJuIGBDbGluaWNhbEltcHJlc3Npb24/ZW5jb3VudGVyPSR7KDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykocmVzb3VyY2UuZW5jb3VudGVyKX1gOwogIH0gZWxzZSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgcmVzb3VyY2UgdHlwZSIpOwogIH0KfQp2YXIgc2VsZlJlcG9ydGVkSGlzdG9yeSA9IHsKICAiQmxvb2QgY2xvdHMiOiB7CiAgICBjb2Rpbmc6IFsKICAgICAgewogICAgICAgIGNvZGU6ICJJNzQuOSIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiRW1ib2xpc20gYW5kIHRocm9tYm9zaXMgb2YgdW5zcGVjaWZpZWQgYXJ0ZXJ5IgogICAgICB9CiAgICBdCiAgfSwKICBTdHJva2U6IHsKICAgIGNvZGluZzogWwogICAgICB7CiAgICAgICAgY29kZTogIkk2My45IiwKICAgICAgICBzeXN0ZW06ICJodHRwOi8vaGw3Lm9yZy9maGlyL3NpZC9pY2QtMTAiLAogICAgICAgIGRpc3BsYXk6ICJDZXJlYnJhbCBpbmZhcmN0aW9uLCB1bnNwZWNpZmllZCIKICAgICAgfQogICAgXQogIH0sCiAgIkJyZWFzdCBjYW5jZXIiOiB7CiAgICBjb2Rpbmc6IFsKICAgICAgewogICAgICAgIGNvZGU6ICJEMDUuMTAiLAogICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCIsCiAgICAgICAgZGlzcGxheTogIkludHJhZHVjdGFsIGNhcmNpbm9tYSBpbiBzaXR1IG9mIHVuc3BlY2lmaWVkIGJyZWFzdCIKICAgICAgfQogICAgXQogIH0sCiAgIkVuZG9tZXRyaWFsIGNhbmNlciI6IHsKICAgIGNvZGluZzogWwogICAgICB7CiAgICAgICAgY29kZTogIkM1NC4xIiwKICAgICAgICBzeXN0ZW06ICJodHRwOi8vaGw3Lm9yZy9maGlyL3NpZC9pY2QtMTAiLAogICAgICAgIGRpc3BsYXk6ICJNYWxpZ25hbnQgbmVvcGxhc20gb2YgZW5kb21ldHJpdW0iCiAgICAgIH0KICAgIF0KICB9LAogICJJcnJlZ3VsYXIgYmxlZWRpbmciOiB7CiAgICBjb2Rpbmc6IFsKICAgICAgewogICAgICAgIGNvZGU6ICJOOTIuMSIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiRXhjZXNzaXZlIGFuZCBmcmVxdWVudCBtZW5zdHJ1YXRpb24gd2l0aCBpcnJlZ3VsYXIgY3ljbGUiCiAgICAgIH0KICAgIF0KICB9LAogICJCTUkgPiAzMCI6IHsKICAgIGNvZGluZzogWwogICAgICB7CiAgICAgICAgY29kZTogIkU2Ni45IiwKICAgICAgICBzeXN0ZW06ICJodHRwOi8vaGw3Lm9yZy9maGlyL3NpZC9pY2QtMTAiLAogICAgICAgIGRpc3BsYXk6ICJPYmVzaXR5LCB1bnNwZWNpZmllZCIKICAgICAgfQogICAgXQogIH0KfTsKCi8vIHNyYy9ib3RzL2NvcmUvb2JzZXJ2YXRpb24tdXRpbHMudHMKZnVuY3Rpb24gY2FsY3VsYXRlQk1JKGhlaWdodCwgd2VpZ2h0KSB7CiAgaWYgKCFoZWlnaHQ/LnZhbHVlIHx8ICF3ZWlnaHQ/LnZhbHVlKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIkFsbCB2YWx1ZXMgbXVzdCBiZSBwcm92aWRlZCIpOwogIH0KICBjb25zdCBoZWlnaHRNID0gZ2V0SGVpZ2h0SW5NZXRlcnMoaGVpZ2h0KTsKICBjb25zdCB3ZWlnaHRLZyA9IGdldFdlaWdodEluS2lsb2dyYW1zKHdlaWdodCk7CiAgY29uc3QgYm1pID0gTWF0aC5yb3VuZCh3ZWlnaHRLZyAvIGhlaWdodE0gKiogMiAqIDEwKSAvIDEwOwogIHJldHVybiB7CiAgICB2YWx1ZTogYm1pLAogICAgdW5pdDogImtnL21eMiIKICB9Owp9CmZ1bmN0aW9uIGdldFdlaWdodEluS2lsb2dyYW1zKHdlaWdodCkgewogIGlmICghd2VpZ2h0LnVuaXQpIHsKICAgIHRocm93IG5ldyBFcnJvcigiTm8gdW5pdCBkZWZpbmVkIik7CiAgfQogIGNvbnN0IHVuaXQgPSB3ZWlnaHQudW5pdDsKICBjb25zdCB3ZWlnaHRWYWwgPSB3ZWlnaHQudmFsdWU7CiAgc3dpdGNoICh1bml0KSB7CiAgICBjYXNlICJsYiI6CiAgICAgIHJldHVybiB3ZWlnaHRWYWwgLyAyLjI7CiAgICBjYXNlICJrZyI6CiAgICAgIHJldHVybiB3ZWlnaHRWYWw7CiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gdW5pdC4gUGxlYXNlIHByb3ZpZGUgd2VpZ2h0IGluIG9uZSBvZiB0aGUgZm9sbG93aW5nIHVuaXRzOiBQb3VuZHMgb3Iga2lsb2dyYW1zLiIpOwogIH0KfQpmdW5jdGlvbiBnZXRIZWlnaHRJbk1ldGVycyhoZWlnaHQpIHsKICBpZiAoIWhlaWdodC51bml0KSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIHVuaXQgZGVmaW5lZCIpOwogIH0KICBjb25zdCB1bml0ID0gaGVpZ2h0LnVuaXQ7CiAgY29uc3QgaGVpZ2h0VmFsID0gaGVpZ2h0LnZhbHVlOwogIHN3aXRjaCAodW5pdCkgewogICAgY2FzZSAiaW4iOgogICAgICByZXR1cm4gaGVpZ2h0VmFsICogMi41NCAvIDEwMDsKICAgIGNhc2UgImZ0IjoKICAgICAgcmV0dXJuIGhlaWdodFZhbCAqIDEyICogMi41NCAvIDEwMDsKICAgIGNhc2UgImNtIjoKICAgICAgcmV0dXJuIGhlaWdodFZhbCAvIDEwMDsKICAgIGNhc2UgIm0iOgogICAgICByZXR1cm4gaGVpZ2h0VmFsOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICJVbmtub3duIHVuaXQuIFBsZWFzZSBwcm92aWRlIGhlaWdodCBpbiBvbmUgb2YgdGhlIGZvbGxvd2luZyB1bml0czogSW5jaGVzLCBmZWV0LCBjZW50aW1ldGVycywgb3IgbWV0ZXJzLiIKICAgICAgKTsKICB9Cn0KCi8vIHNyYy9ib3RzL2NvcmUvb2JzdGV0cmljLWVuY291bnRlci1ub3RlLnRzCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIobWVkcGx1bSwgZXZlbnQpIHsKICBjb25zdCByZXNwb25zZSA9IGV2ZW50LmlucHV0OwogIGNvbnN0IGFuc3dlcnMgPSAoMCwgaW1wb3J0X2NvcmUyLmdldFF1ZXN0aW9ubmFpcmVBbnN3ZXJzKShyZXNwb25zZSk7CiAgY29uc3QgZW5jb3VudGVyID0gYXdhaXQgbWVkcGx1bS5yZWFkUmVmZXJlbmNlKHJlc3BvbnNlLmVuY291bnRlcik7CiAgY29uc3QgdXNlciA9IG1lZHBsdW0uZ2V0UHJvZmlsZSgpOwogIGlmICghYW5zd2Vyc1sicmVhc29uLWZvci12aXNpdCJdKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk11c3QgcHJvdmlkZSBhIHJlYXNvbiBmb3IgdGhlIHZpc2l0Iik7CiAgfQogIGNvbnN0IGRhdGUgPSBhbnN3ZXJzWyJkYXRlIl0udmFsdWVEYXRlVGltZTsKICBjb25zdCBvYnNlcnZhdGlvbkRhdGEgPSB7CiAgICBncmF2aWRhOiBhbnN3ZXJzWyJncmF2aWRhIl0sCiAgICBwYXJhOiBhbnN3ZXJzWyJwYXJhIl0sCiAgICBnZXN0YXRpb25hbERheXM6IGFuc3dlcnNbImdlc3RhdGlvbmFsLWFnZS1kYXlzIl0sCiAgICBnZXN0YXRpb25hbFdlZWtzOiBhbnN3ZXJzWyJnZXN0YXRpb25hbC1hZ2Utd2Vla3MiXSwKICAgIGhlaWdodDogYW5zd2Vyc1siaGVpZ2h0Il0sCiAgICB3ZWlnaHQ6IGFuc3dlcnNbIndlaWdodCJdLAogICAgdG90YWxXZWlnaHRHYWluOiBhbnN3ZXJzWyJ0b3RhbC13ZWlnaHQtZ2FpbiJdLAogICAgc3lzdG9saWM6IGFuc3dlcnNbInN5c3RvbGljIl0sCiAgICBkaWFzdG9saWM6IGFuc3dlcnNbImRpYXN0b2xpYyJdCiAgfTsKICBpZiAob2JzZXJ2YXRpb25EYXRhLmhlaWdodCAmJiBvYnNlcnZhdGlvbkRhdGEud2VpZ2h0KSB7CiAgICBvYnNlcnZhdGlvbkRhdGEuYm1pID0gY2FsY3VsYXRlQk1JKG9ic2VydmF0aW9uRGF0YS5oZWlnaHQudmFsdWVRdWFudGl0eSwgb2JzZXJ2YXRpb25EYXRhLndlaWdodC52YWx1ZVF1YW50aXR5KTsKICB9CiAgY29uc3QgYWRkVG9Qcm9ibGVtTGlzdCA9IGFuc3dlcnNbInByb2JsZW0tbGlzdCJdPy52YWx1ZUJvb2xlYW4gPz8gZmFsc2U7CiAgY29uc3QgcGFydGlhbENvbmRpdGlvbiA9IHsKICAgIHJlc291cmNlVHlwZTogIkNvbmRpdGlvbiIsCiAgICBjb2RlOiBhbnN3ZXJzWyJyZWFzb24tZm9yLXZpc2l0Il0udmFsdWVDb2RpbmcKICB9OwogIGNvbnN0IG5vdGUgPSBhbnN3ZXJzWyJhc3Nlc3NtZW50Il0/LnZhbHVlU3RyaW5nOwogIGNvbnN0IG9ic2VydmF0aW9ucyA9IGNyZWF0ZU9ic2VydmF0aW9ucyhvYnNlcnZhdGlvbkRhdGEsIG9ic3RldHJpY0NvZGVzLCBlbmNvdW50ZXIsIHVzZXIsIHJlc3BvbnNlLCBkYXRlKTsKICBjb25zdCBjb25kaXRpb25zID0gY3JlYXRlQ29uZGl0aW9ucyhwYXJ0aWFsQ29uZGl0aW9uLCBlbmNvdW50ZXIsIHVzZXIsIGFkZFRvUHJvYmxlbUxpc3QpOwogIGNvbnN0IGNsaW5pY2FsSW1wcmVzc2lvbnMgPSBjcmVhdGVDbGluaWNhbEltcHJlc3Npb24oZW5jb3VudGVyLCB1c2VyLCBub3RlKTsKICBjb25zdCByZXNvdXJjZXMgPSBbLi4ub2JzZXJ2YXRpb25zLCAuLi5jb25kaXRpb25zXTsKICBpZiAoY2xpbmljYWxJbXByZXNzaW9ucykgewogICAgcmVzb3VyY2VzLnB1c2goY2xpbmljYWxJbXByZXNzaW9ucyk7CiAgfQogIGNvbnN0IGJ1bmRsZSA9IGNyZWF0ZUJ1bmRsZShyZXNvdXJjZXMpOwogIGNvbnN0IHJlc3BvbnNlQnVuZGxlID0gYXdhaXQgbWVkcGx1bS5leGVjdXRlQmF0Y2goYnVuZGxlKTsKICByZXR1cm4gcmVzcG9uc2VCdW5kbGU7Cn0KdmFyIG9ic3RldHJpY0NvZGVzID0gewogIGhlaWdodDogewogICAgY29kaW5nOiBbeyBjb2RlOiAiODMwMi0yIiwgc3lzdGVtOiBpbXBvcnRfY29yZTIuTE9JTkMsIGRpc3BsYXk6ICJCb2R5IGhlaWdodCIgfV0KICB9LAogIHdlaWdodDogewogICAgY29kaW5nOiBbeyBjb2RlOiAiMjk0NjMtNyIsIHN5c3RlbTogaW1wb3J0X2NvcmUyLkxPSU5DLCBkaXNwbGF5OiAiQm9keSB3ZWlnaHQiIH1dCiAgfSwKICBibG9vZFByZXNzdXJlOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICIzNTA5NC0yIiwgc3lzdGVtOiBpbXBvcnRfY29yZTIuTE9JTkMsIGRpc3BsYXk6ICJCbG9vZCBwcmVzc3VyZSBwYW5lbCIgfV0KICB9LAogIGJtaTogewogICAgY29kaW5nOiBbeyBjb2RlOiAiMzkxNTYtNSIsIHN5c3RlbTogaW1wb3J0X2NvcmUyLkxPSU5DLCBkaXNwbGF5OiAiQm9keSBNYXNzIEluZGV4IChCTUkpIiB9XQogIH0sCiAgZ3JhdmlkYTogewogICAgY29kaW5nOiBbeyBjb2RlOiAiMTYxNzMyMDA2Iiwgc3lzdGVtOiBpbXBvcnRfY29yZTIuU05PTUVELCBkaXNwbGF5OiAiR3JhdmlkYSIgfV0KICB9LAogIHBhcmE6IHsKICAgIGNvZGluZzogW3sgY29kZTogIjExODIxMjAwMCIsIHN5c3RlbTogaW1wb3J0X2NvcmUyLlNOT01FRCwgZGlzcGxheTogIlBhcml0eSBmaW5kaW5nIiB9XQogIH0sCiAgZ2VzdGF0aW9uYWxEYXlzOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICI0OTA1Mi00Iiwgc3lzdGVtOiBpbXBvcnRfY29yZTIuTE9JTkMsIGRpc3BsYXk6ICJHZXN0YXRpb25hbCBhZ2UgaW4gZGF5cyIgfV0KICB9LAogIGdlc3RhdGlvbmFsV2Vla3M6IHsKICAgIGNvZGluZzogW3sgY29kZTogIjQ5MDUxLTYiLCBzeXN0ZW06IGltcG9ydF9jb3JlMi5MT0lOQywgZGlzcGxheTogIkdlc3RhdGlvbmFsIGFnZSBpbiB3ZWVrcyIgfV0KICB9LAogIHRvdGFsV2VpZ2h0R2FpbjogewogICAgY29kaW5nOiBbeyBjb2RlOiAiNTYwNzgtOSIsIHN5c3RlbTogaW1wb3J0X2NvcmUyLkxPSU5DLCBkaXNwbGF5OiAiV2VpZ2h0IGdhaW4gW01hc3NdIC0tZHVyaW5nIGN1cnJlbnQgcHJlZ25hbmN5IiB9XQogIH0KfTsKLy8gQW5ub3RhdGUgdGhlIENvbW1vbkpTIGV4cG9ydCBuYW1lcyBmb3IgRVNNIGltcG9ydCBpbiBub2RlOgowICYmIChtb2R1bGUuZXhwb3J0cyA9IHsKICBoYW5kbGVyCn0pOwpPYmplY3QuYXNzaWduKGV4cG9ydHMsIG1vZHVsZS5leHBvcnRzKTsK"
      }
    },
    {
      "request": {
        "method": "PUT",
        "url": "$bot-obstetric-encounter-note-reference"
      },
      "resource": {
        "resourceType": "Bot",
        "id": "$bot-obstetric-encounter-note-id",
        "name": "obstetric-encounter-note",
        "runtimeVersion": "awslambda",
        "sourceCode": {
          "contentType": "text/typescript",
          "url": "urn:uuid:618598f7-692d-481a-ac4f-ce1486197e82"
        },
        "executableCode": {
          "contentType": "text/javascript",
          "url": "urn:uuid:ffac9cf1-3b10-448f-a54d-d966c886aac1"
        }
      }
    },
    {
      "request": {
        "url": "Subscription",
        "method": "POST",
        "ifNoneExist": "url=$bot-obstetric-encounter-note-reference"
      },
      "resource": {
        "resourceType": "Subscription",
        "status": "active",
        "reason": "obstetric-encounter-note",
        "channel": {
          "endpoint": "$bot-obstetric-encounter-note-reference",
          "type": "rest-hook"
        },
        "criteria": "QuestionnaireResponse?questionnaire=$obstetric-visit"
      }
    },
    {
      "fullUrl": "urn:uuid:35870bee-7d1f-4a93-9e5a-53a9e7ec0e20",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/typescript",
        "data": "aW1wb3J0IHsgQm90RXZlbnQsIGdldFF1ZXN0aW9ubmFpcmVBbnN3ZXJzLCBMT0lOQywgTWVkcGx1bUNsaWVudCwgU05PTUVEIH0gZnJvbSAnQG1lZHBsdW0vY29yZSc7CmltcG9ydCB7CiAgQnVuZGxlLAogIENsaW5pY2FsSW1wcmVzc2lvbiwKICBDb2RlYWJsZUNvbmNlcHQsCiAgQ29uZGl0aW9uLAogIEVuY291bnRlciwKICBPYnNlcnZhdGlvbiwKICBQcmFjdGl0aW9uZXIsCiAgUXVlc3Rpb25uYWlyZVJlc3BvbnNlLAogIFF1ZXN0aW9ubmFpcmVSZXNwb25zZUl0ZW1BbnN3ZXIsCiAgUmVmZXJlbmNlLAp9IGZyb20gJ0BtZWRwbHVtL2ZoaXJ0eXBlcyc7CmltcG9ydCB7IGNyZWF0ZUJ1bmRsZSwgY3JlYXRlQ2xpbmljYWxJbXByZXNzaW9uLCBjcmVhdGVDb25kaXRpb25zLCBjcmVhdGVPYnNlcnZhdGlvbnMgfSBmcm9tICcuL2NoYXJ0aW5nLXV0aWxzJzsKaW1wb3J0IHsgY2FsY3VsYXRlQk1JIH0gZnJvbSAnLi9vYnNlcnZhdGlvbi11dGlscyc7CgpleHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihtZWRwbHVtOiBNZWRwbHVtQ2xpZW50LCBldmVudDogQm90RXZlbnQ8UXVlc3Rpb25uYWlyZVJlc3BvbnNlPik6IFByb21pc2U8QnVuZGxlPiB7CiAgLy8gUGFyc2UgdGhlIGFuc3dlcnMgZnJvbSB0aGUgUXVlc3Rpb25uYWlyZVJlc3BvbnNlCiAgY29uc3QgcmVzcG9uc2UgPSBldmVudC5pbnB1dDsKICBjb25zdCBhbnN3ZXJzID0gZ2V0UXVlc3Rpb25uYWlyZUFuc3dlcnMocmVzcG9uc2UpOwogIC8vIEdldCB0aGUgbGlua2VkIGVuY291bnRlciBhbmQgdXNlciB3aG8gaW5pdGlhdGVkIHRoZSBib3QKICBjb25zdCBlbmNvdW50ZXIgPSBhd2FpdCBtZWRwbHVtLnJlYWRSZWZlcmVuY2UocmVzcG9uc2UuZW5jb3VudGVyIGFzIFJlZmVyZW5jZTxFbmNvdW50ZXI+KTsKICBjb25zdCB1c2VyID0gbWVkcGx1bS5nZXRQcm9maWxlKCkgYXMgUHJhY3RpdGlvbmVyOwoKICAvLyBSZWFzb24gZm9yIHZpc2l0IGlzIHJlcXVpcmVkIHRvIGhhdmUgYW4gYW5zd2VyLCBzbyBhbiBlcnJvciBpcyB0aHJvd24gaWYgdGhlcmUgaXNuJ3Qgb25lCiAgaWYgKCFhbnN3ZXJzWydyZWFzb24tZm9yLXZpc2l0J10/LnZhbHVlQ29kaW5nKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ011c3QgcHJvdmlkZSBhIHJlYXNvbiBmb3IgdGhlIHZpc2l0Jyk7CiAgfQoKICBjb25zdCBkYXRlID0gYW5zd2Vyc1snZGF0ZSddLnZhbHVlRGF0ZVRpbWUgYXMgc3RyaW5nOwoKICAvLyBQYXJzZSB0aGUgYW5zd2VycyBpbnRvIG1vcmUgZWFzaWx5IHVzYWJsZSBvYmplY3RzCiAgY29uc3Qgb2JzZXJ2YXRpb25EYXRhOiBSZWNvcmQ8c3RyaW5nLCBRdWVzdGlvbm5haXJlUmVzcG9uc2VJdGVtQW5zd2VyPiA9IHsKICAgIGxhc3RQZXJpb2Q6IGFuc3dlcnNbJ2xhc3QtcGVyaW9kJ10sCiAgICBjb250cmFjZXB0aW9uOiBhbnN3ZXJzWydjb250cmFjZXB0aW9uJ10sCiAgICBsYXN0TWFtbW9ncmFtOiBhbnN3ZXJzWydtYW1tb2dyYW0nXSwKICAgIHNtb2tpbmdTdGF0dXM6IGFuc3dlcnNbJ3Ntb2tpbmcnXSwKICAgIGRydWdVc2U6IGFuc3dlcnNbJ2RydWdzJ10sCiAgICBob3VzaW5nU3RhdHVzOiBhbnN3ZXJzWydob3VzaW5nJ10sCiAgICBoZWlnaHQ6IGFuc3dlcnNbJ2hlaWdodCddLAogICAgd2VpZ2h0OiBhbnN3ZXJzWyd3ZWlnaHQnXSwKICAgIHN5c3RvbGljOiBhbnN3ZXJzWydzeXN0b2xpYyddLAogICAgZGlhc3RvbGljOiBhbnN3ZXJzWydkaWFzdG9saWMnXSwKICB9OwoKICBpZiAob2JzZXJ2YXRpb25EYXRhLmhlaWdodCAmJiBvYnNlcnZhdGlvbkRhdGEud2VpZ2h0KSB7CiAgICBvYnNlcnZhdGlvbkRhdGEuYm1pID0gY2FsY3VsYXRlQk1JKG9ic2VydmF0aW9uRGF0YS5oZWlnaHQudmFsdWVRdWFudGl0eSwgb2JzZXJ2YXRpb25EYXRhLndlaWdodC52YWx1ZVF1YW50aXR5KTsKICB9CgogIGNvbnN0IGFkZFRvUHJvYmxlbUxpc3QgPSBhbnN3ZXJzWydwcm9ibGVtLWxpc3QnXT8udmFsdWVCb29sZWFuID8/IGZhbHNlOwoKICBjb25zdCBwYXJ0aWFsQ29uZGl0aW9uOiBQYXJ0aWFsPENvbmRpdGlvbj4gPSB7CiAgICByZXNvdXJjZVR5cGU6ICdDb25kaXRpb24nLAogICAgY29kZTogYW5zd2Vyc1sncmVhc29uLWZvci12aXNpdCddLnZhbHVlQ29kaW5nLAogIH07CgogIGNvbnN0IG5vdGUgPSBhbnN3ZXJzWydhc3Nlc3NtZW50J10/LnZhbHVlU3RyaW5nOwoKICAvLyBDcmVhdGUgcmVzb3VyY2VzIGZyb20gdGhlIGFib3ZlIG9iamVjdHMKICBjb25zdCBvYnNlcnZhdGlvbnMgPSBjcmVhdGVPYnNlcnZhdGlvbnMob2JzZXJ2YXRpb25EYXRhLCBneW5lY29sb2d5Q29kZXMsIGVuY291bnRlciwgdXNlciwgcmVzcG9uc2UsIGRhdGUpOwogIGNvbnN0IGNvbmRpdGlvbnMgPSBjcmVhdGVDb25kaXRpb25zKHBhcnRpYWxDb25kaXRpb24sIGVuY291bnRlciwgdXNlciwgYWRkVG9Qcm9ibGVtTGlzdCk7CiAgY29uc3QgY2xpbmljYWxJbXByZXNzaW9ucyA9IGNyZWF0ZUNsaW5pY2FsSW1wcmVzc2lvbihlbmNvdW50ZXIsIHVzZXIsIG5vdGUpOwoKICAvLyBDcmVhdGUgYW4gYXJyYXkgb2YgYnVuZGxlIGVudHJpZXMgZm9yIGFsbCByZXNvdXJjZSB0eXBlcwogIGNvbnN0IHJlc291cmNlczogKE9ic2VydmF0aW9uIHwgQ29uZGl0aW9uIHwgQ2xpbmljYWxJbXByZXNzaW9uKVtdID0gWy4uLm9ic2VydmF0aW9ucywgLi4uY29uZGl0aW9uc107CiAgaWYgKGNsaW5pY2FsSW1wcmVzc2lvbnMpIHsKICAgIHJlc291cmNlcy5wdXNoKGNsaW5pY2FsSW1wcmVzc2lvbnMpOwogIH0KCiAgY29uc3QgYnVuZGxlID0gY3JlYXRlQnVuZGxlKHJlc291cmNlcyk7CgogIC8vIEV4ZWN1dGUgdGhlIGJhdGNoIHRvIGNyZWF0ZSBhbGwgcmVzb3VyY2VzIGF0IG9uY2UKICBjb25zdCByZXNwb25zZUJ1bmRsZSA9IGF3YWl0IG1lZHBsdW0uZXhlY3V0ZUJhdGNoKGJ1bmRsZSk7CiAgcmV0dXJuIHJlc3BvbnNlQnVuZGxlOwp9Cgpjb25zdCBneW5lY29sb2d5Q29kZXM6IFJlY29yZDxzdHJpbmcsIENvZGVhYmxlQ29uY2VwdD4gPSB7CiAgbGFzdFBlcmlvZDogewogICAgY29kaW5nOiBbeyBjb2RlOiAnODY2NS0yJywgc3lzdGVtOiBMT0lOQywgZGlzcGxheTogJ0xhc3QgbWVuc3RydWFsIHBlcmlvZCBzdGFydCBkYXRlJyB9XSwKICB9LAogIGNvbnRyYWNlcHRpb246IHsKICAgIGNvZGluZzogW3sgY29kZTogJzg2NTktNScsIHN5c3RlbTogTE9JTkMsIGRpc3BsYXk6ICdCaXJ0aCBjb250cm9sIG1ldGhvZCAtIFJlcG9ydGVkJyB9XSwKICB9LAogIGxhc3RNYW1tb2dyYW06IHsKICAgIGNvZGluZzogW3sgY29kZTogJzQyOTczNjAwOCcsIHN5c3RlbTogU05PTUVELCBkaXNwbGF5OiAnRGF0ZSBvZiBsYXN0IG1hbW1vZ3JhbScgfV0sCiAgfSwKICBzbW9raW5nU3RhdHVzOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICc3MjE2Ni0yJywgc3lzdGVtOiBMT0lOQywgZGlzcGxheTogJ1RvYmFjY28gc21va2luZyBzdGF0dXMnIH1dLAogIH0sCiAgZHJ1Z1VzZTogewogICAgY29kaW5nOiBbeyBjb2RlOiAnNzQyMDQtOScsIHN5c3RlbTogTE9JTkMsIGRpc3BsYXk6ICdEcnVnIHVzZScgfV0sCiAgfSwKICBob3VzaW5nU3RhdHVzOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICc3MTgwMi0zJywgc3lzdGVtOiBMT0lOQywgZGlzcGxheTogJ0hvdXNpbmcgc3RhdHVzJyB9XSwKICB9LAogIGhlaWdodDogewogICAgY29kaW5nOiBbeyBjb2RlOiAnODMwMi0yJywgc3lzdGVtOiBMT0lOQywgZGlzcGxheTogJ0JvZHkgaGVpZ2h0JyB9XSwKICB9LAogIHdlaWdodDogewogICAgY29kaW5nOiBbeyBjb2RlOiAnMjk0NjMtNycsIHN5c3RlbTogTE9JTkMsIGRpc3BsYXk6ICdCb2R5IHdlaWdodCcgfV0sCiAgfSwKICBibG9vZFByZXNzdXJlOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICczNTA5NC0yJywgc3lzdGVtOiBMT0lOQywgZGlzcGxheTogJ0Jsb29kIHByZXNzdXJlIHBhbmVsJyB9XSwKICB9LAogIGJtaTogewogICAgY29kaW5nOiBbeyBjb2RlOiAnMzkxNTYtNScsIHN5c3RlbTogTE9JTkMsIGRpc3BsYXk6ICdCb2R5IE1hc3MgSW5kZXggKEJNSSknIH1dLAogIH0sCn07Cg=="
      }
    },
    {
      "fullUrl": "urn:uuid:2304998d-2ebb-4738-976c-8ba983d7d727",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/javascript",
        "data": "InVzZSBzdHJpY3QiOwp2YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Owp2YXIgX19nZXRPd25Qcm9wRGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CnZhciBfX2dldE93blByb3BOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwp2YXIgX19oYXNPd25Qcm9wID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIF9fZXhwb3J0ID0gKHRhcmdldCwgYWxsKSA9PiB7CiAgZm9yICh2YXIgbmFtZSBpbiBhbGwpCiAgICBfX2RlZlByb3AodGFyZ2V0LCBuYW1lLCB7IGdldDogYWxsW25hbWVdLCBlbnVtZXJhYmxlOiB0cnVlIH0pOwp9Owp2YXIgX19jb3B5UHJvcHMgPSAodG8sIGZyb20sIGV4Y2VwdCwgZGVzYykgPT4gewogIGlmIChmcm9tICYmIHR5cGVvZiBmcm9tID09PSAib2JqZWN0IiB8fCB0eXBlb2YgZnJvbSA9PT0gImZ1bmN0aW9uIikgewogICAgZm9yIChsZXQga2V5IG9mIF9fZ2V0T3duUHJvcE5hbWVzKGZyb20pKQogICAgICBpZiAoIV9faGFzT3duUHJvcC5jYWxsKHRvLCBrZXkpICYmIGtleSAhPT0gZXhjZXB0KQogICAgICAgIF9fZGVmUHJvcCh0bywga2V5LCB7IGdldDogKCkgPT4gZnJvbVtrZXldLCBlbnVtZXJhYmxlOiAhKGRlc2MgPSBfX2dldE93blByb3BEZXNjKGZyb20sIGtleSkpIHx8IGRlc2MuZW51bWVyYWJsZSB9KTsKICB9CiAgcmV0dXJuIHRvOwp9Owp2YXIgX190b0NvbW1vbkpTID0gKG1vZCkgPT4gX19jb3B5UHJvcHMoX19kZWZQcm9wKHt9LCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIG1vZCk7CgovLyBzcmMvYm90cy9jb3JlL2d5bmVjb2xvZ3ktZW5jb3VudGVyLW5vdGUudHMKdmFyIGd5bmVjb2xvZ3lfZW5jb3VudGVyX25vdGVfZXhwb3J0cyA9IHt9OwpfX2V4cG9ydChneW5lY29sb2d5X2VuY291bnRlcl9ub3RlX2V4cG9ydHMsIHsKICBoYW5kbGVyOiAoKSA9PiBoYW5kbGVyCn0pOwptb2R1bGUuZXhwb3J0cyA9IF9fdG9Db21tb25KUyhneW5lY29sb2d5X2VuY291bnRlcl9ub3RlX2V4cG9ydHMpOwp2YXIgaW1wb3J0X2NvcmUyID0gcmVxdWlyZSgiQG1lZHBsdW0vY29yZSIpOwoKLy8gc3JjL2JvdHMvY29yZS9jaGFydGluZy11dGlscy50cwp2YXIgaW1wb3J0X2NvcmUgPSByZXF1aXJlKCJAbWVkcGx1bS9jb3JlIik7CnZhciBpbXBvcnRfY3J5cHRvID0gcmVxdWlyZSgiY3J5cHRvIik7CmZ1bmN0aW9uIGNyZWF0ZU9ic2VydmF0aW9ucyhvYnNlcnZhdGlvbkRhdGEsIGNvZGVzLCBlbmNvdW50ZXIsIHVzZXIsIHJlc3BvbnNlLCBkYXRlKSB7CiAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgY29uc3QgYmxvb2RQcmVzc3VyZSA9IHsKICAgIHN5c3RvbGljOiBvYnNlcnZhdGlvbkRhdGEuc3lzdG9saWM/LnZhbHVlUXVhbnRpdHksCiAgICBkaWFzdG9saWM6IG9ic2VydmF0aW9uRGF0YS5kaWFzdG9saWM/LnZhbHVlUXVhbnRpdHkKICB9OwogIGNvbnN0IGJsb29kUHJlc3N1cmVPYnNlcnZhdGlvbiA9IGNyZWF0ZUJsb29kUHJlc3N1cmVPYnNlcnZhdGlvbihibG9vZFByZXNzdXJlLCBlbmNvdW50ZXIsIHVzZXIsIGRhdGUsIHJlc3BvbnNlKTsKICBpZiAoYmxvb2RQcmVzc3VyZU9ic2VydmF0aW9uKSB7CiAgICBvYnNlcnZhdGlvbnMucHVzaChibG9vZFByZXNzdXJlT2JzZXJ2YXRpb24pOwogIH0KICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhvYnNlcnZhdGlvbkRhdGEpKSB7CiAgICBpZiAoIXZhbHVlIHx8IGtleSA9PT0gInN5c3RvbGljIiB8fCBrZXkgPT09ICJkaWFzdG9saWMiKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKGtleSA9PT0gInNlbGZSZXBvcnRlZEhpc3RvcnkiICYmICF2YWx1ZT8udmFsdWVTdHJpbmcpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHJlcG9ydGVkIGhpc3RvcnkiKTsKICAgIH0KICAgIGNvbnN0IGNvZGUgPSBrZXkgPT09ICJzZWxmUmVwb3J0ZWRIaXN0b3J5IiA/IHNlbGZSZXBvcnRlZEhpc3RvcnlbdmFsdWUudmFsdWVTdHJpbmddIDogY29kZXNba2V5XTsKICAgIGlmICghY29kZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIGNvZGUgcHJvdmlkZWQiKTsKICAgIH0KICAgIGNvbnN0IHJlc291cmNlID0gewogICAgICBjb2RlLAogICAgICAuLi5vYnNlcnZhdGlvbkRhdGFba2V5XQogICAgfTsKICAgIGNvbnN0IG9ic2VydmF0aW9uID0gewogICAgICAuLi5yZXNvdXJjZSwKICAgICAgcmVzb3VyY2VUeXBlOiAiT2JzZXJ2YXRpb24iLAogICAgICBjb2RlLAogICAgICBzdGF0dXM6ICJmaW5hbCIsCiAgICAgIHN1YmplY3Q6IGVuY291bnRlci5zdWJqZWN0LAogICAgICBwZXJmb3JtZXI6IFt7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfV0sCiAgICAgIGVuY291bnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKGVuY291bnRlcikgfSwKICAgICAgZWZmZWN0aXZlRGF0ZVRpbWU6IGRhdGUsCiAgICAgIGRlcml2ZWRGcm9tOiBbeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHJlc3BvbnNlKSB9XQogICAgfTsKICAgIG9ic2VydmF0aW9ucy5wdXNoKG9ic2VydmF0aW9uKTsKICB9CiAgcmV0dXJuIG9ic2VydmF0aW9uczsKfQpmdW5jdGlvbiBjcmVhdGVCbG9vZFByZXNzdXJlT2JzZXJ2YXRpb24oYmxvb2RQcmVzc3VyZSwgZW5jb3VudGVyLCB1c2VyLCBkYXRlLCByZXNwb25zZSkgewogIGNvbnN0IHsgc3lzdG9saWMsIGRpYXN0b2xpYyB9ID0gYmxvb2RQcmVzc3VyZTsKICBpZiAoIXN5c3RvbGljICYmICFkaWFzdG9saWMpIHsKICAgIHJldHVybiB2b2lkIDA7CiAgfQogIGNvbnN0IGNvbXBvbmVudCA9IGhhbmRsZUJsb29kUHJlc3N1cmUoc3lzdG9saWMsIGRpYXN0b2xpYyk7CiAgY29uc3QgYmxvb2RQcmVzc3VyZU9ic2VydmF0aW9uID0gewogICAgcmVzb3VyY2VUeXBlOiAiT2JzZXJ2YXRpb24iLAogICAgc3RhdHVzOiAiZmluYWwiLAogICAgY29kZTogewogICAgICBjb2Rpbmc6IFt7IGNvZGU6ICIzNTA5NC0yIiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJCbG9vZCBwcmVzc3VyZSBwYW5lbCIgfV0KICAgIH0sCiAgICBzdWJqZWN0OiBlbmNvdW50ZXIuc3ViamVjdCwKICAgIHBlcmZvcm1lcjogW3sgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKSh1c2VyKSB9XSwKICAgIGVuY291bnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKGVuY291bnRlcikgfSwKICAgIGVmZmVjdGl2ZURhdGVUaW1lOiBkYXRlLAogICAgZGVyaXZlZEZyb206IFt7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykocmVzcG9uc2UpIH1dLAogICAgY29tcG9uZW50CiAgfTsKICByZXR1cm4gYmxvb2RQcmVzc3VyZU9ic2VydmF0aW9uOwp9CmZ1bmN0aW9uIGhhbmRsZUJsb29kUHJlc3N1cmUoc3lzdG9saWMsIGRpYXN0b2xpYykgewogIGNvbnN0IGNvbXBvbmVudHMgPSBbXTsKICBpZiAoZGlhc3RvbGljKSB7CiAgICBjb21wb25lbnRzLnB1c2goewogICAgICBjb2RlOiB7IGNvZGluZzogW3sgY29kZTogIjg0NjItNCIsIHN5c3RlbTogImh0dHA6Ly9sb2luYy5vcmciLCBkaXNwbGF5OiAiRGlhc3RvbGljIGJsb29kIHByZXNzdXJlIiB9XSB9LAogICAgICB2YWx1ZVF1YW50aXR5OiBkaWFzdG9saWMKICAgIH0pOwogIH0KICBpZiAoc3lzdG9saWMpIHsKICAgIGNvbXBvbmVudHMucHVzaCh7CiAgICAgIGNvZGU6IHsgY29kaW5nOiBbeyBjb2RlOiAiODQ4MC02Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJTeXN0b2xpYyBibG9vZCBwcmVzc3VyZSIgfV0gfSwKICAgICAgdmFsdWVRdWFudGl0eTogc3lzdG9saWMKICAgIH0pOwogIH0KICByZXR1cm4gY29tcG9uZW50czsKfQpmdW5jdGlvbiBjcmVhdGVDb25kaXRpb25zKHBhcnRpYWxDb25kaXRpb24sIGVuY291bnRlciwgdXNlciwgcHJvYmxlbUxpc3QpIHsKICBjb25zdCBjb25kaXRpb25zID0gW107CiAgY29uc3QgZW5jb3VudGVyRGlhZ25vc2lzID0gewogICAgLi4ucGFydGlhbENvbmRpdGlvbiwKICAgIHJlc291cmNlVHlwZTogIkNvbmRpdGlvbiIsCiAgICBzdWJqZWN0OiBlbmNvdW50ZXIuc3ViamVjdCwKICAgIGVuY291bnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKGVuY291bnRlcikgfSwKICAgIHJlY29yZGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfSwKICAgIGFzc2VydGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfSwKICAgIGNhdGVnb3J5OiBbCiAgICAgIHsKICAgICAgICBjb2Rpbmc6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9WYWx1ZVNldC9jb25kaXRpb24tY2F0ZWdvcnkiLAogICAgICAgICAgICBjb2RlOiAiZW5jb3VudGVyLWRpYWdub3NpcyIsCiAgICAgICAgICAgIGRpc3BsYXk6ICJFbmNvdW50ZXIgRGlhZ25vc2lzIgogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfQogICAgXQogIH07CiAgY29uZGl0aW9ucy5wdXNoKGVuY291bnRlckRpYWdub3Npcyk7CiAgaWYgKHByb2JsZW1MaXN0KSB7CiAgICBjb25kaXRpb25zLnB1c2goewogICAgICAuLi5wYXJ0aWFsQ29uZGl0aW9uLAogICAgICByZXNvdXJjZVR5cGU6ICJDb25kaXRpb24iLAogICAgICBzdWJqZWN0OiBlbmNvdW50ZXIuc3ViamVjdCwKICAgICAgZW5jb3VudGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykoZW5jb3VudGVyKSB9LAogICAgICByZWNvcmRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHVzZXIpIH0sCiAgICAgIGFzc2VydGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfSwKICAgICAgY2F0ZWdvcnk6IFsKICAgICAgICB7CiAgICAgICAgICBjb2Rpbmc6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvVmFsdWVTZXQvY29uZGl0aW9uLWNhdGVnb3J5IiwKICAgICAgICAgICAgICBjb2RlOiAicHJvYmxlbS1saXN0LWl0ZW0iLAogICAgICAgICAgICAgIGRpc3BsYXk6ICJQcm9ibGVtIExpc3QgSXRlbSIKICAgICAgICAgICAgfQogICAgICAgICAgXQogICAgICAgIH0KICAgICAgXQogICAgfSk7CiAgfQogIHJldHVybiBjb25kaXRpb25zOwp9CmZ1bmN0aW9uIGNyZWF0ZUNsaW5pY2FsSW1wcmVzc2lvbihlbmNvdW50ZXIsIHVzZXIsIG5vdGUpIHsKICBpZiAoIW5vdGUpIHsKICAgIHJldHVybiB2b2lkIDA7CiAgfQogIGNvbnN0IGNsaW5pY2FsSW1wcmVzc2lvbiA9IHsKICAgIHJlc291cmNlVHlwZTogIkNsaW5pY2FsSW1wcmVzc2lvbiIsCiAgICBzdGF0dXM6ICJpbi1wcm9ncmVzcyIsCiAgICBzdWJqZWN0OiBlbmNvdW50ZXIuc3ViamVjdCwKICAgIGVuY291bnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKGVuY291bnRlcikgfSwKICAgIGFzc2Vzc29yOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfSwKICAgIG5vdGU6IFt7IHRleHQ6IG5vdGUgfV0KICB9OwogIHJldHVybiBjbGluaWNhbEltcHJlc3Npb247Cn0KZnVuY3Rpb24gY3JlYXRlQnVuZGxlKHJlc291cmNlcykgewogIGNvbnN0IGJ1bmRsZSA9IHsKICAgIHJlc291cmNlVHlwZTogIkJ1bmRsZSIsCiAgICB0eXBlOiAidHJhbnNhY3Rpb24iCiAgfTsKICBjb25zdCBlbnRyaWVzID0gcmVzb3VyY2VzLm1hcCgocmVzb3VyY2UpID0+IHsKICAgIGNvbnN0IGVudHJ5ID0gewogICAgICBmdWxsVXJsOiBgdXJuOnV1aWQ6JHsoMCwgaW1wb3J0X2NyeXB0by5yYW5kb21VVUlEKSgpfWAsCiAgICAgIHJlcXVlc3Q6IHsgbWV0aG9kOiAiUFVUIiwgdXJsOiBnZXRVcHNlcnRVcmwocmVzb3VyY2UpIH0sCiAgICAgIHJlc291cmNlCiAgICB9OwogICAgcmV0dXJuIGVudHJ5OwogIH0pOwogIGJ1bmRsZS5lbnRyeSA9IGVudHJpZXM7CiAgcmV0dXJuIGJ1bmRsZTsKfQpmdW5jdGlvbiBnZXRVcHNlcnRVcmwocmVzb3VyY2UpIHsKICBpZiAocmVzb3VyY2UucmVzb3VyY2VUeXBlID09PSAiT2JzZXJ2YXRpb24iKSB7CiAgICBjb25zdCBjb2RlID0gcmVzb3VyY2UuY29kZTsKICAgIGlmICghY29kZS5jb2Rpbmc/LlswXS5jb2RlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gY29kZSBwcm92aWRlZCIpOwogICAgfQogICAgaWYgKCFyZXNvdXJjZS5lbmNvdW50ZXIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBsaW5rZWQgZW5jb3VudGVyIik7CiAgICB9CiAgICBjb25zdCB1cmwgPSBgT2JzZXJ2YXRpb24/ZW5jb3VudGVyPSR7KDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykocmVzb3VyY2UuZW5jb3VudGVyKX0mY29kZT0ke2NvZGUuY29kaW5nPy5bMF0uY29kZX1gOwogICAgcmV0dXJuIHVybDsKICB9IGVsc2UgaWYgKHJlc291cmNlLnJlc291cmNlVHlwZSA9PT0gIkNvbmRpdGlvbiIpIHsKICAgIGNvbnN0IGNvZGUgPSByZXNvdXJjZS5jb2RlOwogICAgaWYgKCFjb2RlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gY29kZSBwcm92aWRlZCIpOwogICAgfQogICAgaWYgKCFyZXNvdXJjZS5lbmNvdW50ZXIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBsaW5rZWQgZW5jb3VudGVyIik7CiAgICB9CiAgICByZXR1cm4gYENvbmRpdGlvbj9lbmNvdW50ZXI9JHsoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKShyZXNvdXJjZS5lbmNvdW50ZXIpfSZjb2RlPSR7Y29kZS5jb2Rpbmc/LlswXS5jb2RlfWA7CiAgfSBlbHNlIGlmIChyZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT09ICJDbGluaWNhbEltcHJlc3Npb24iKSB7CiAgICBpZiAoIXJlc291cmNlLmVuY291bnRlcikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIGxpbmtlZCBlbmNvdW50ZXIiKTsKICAgIH0KICAgIHJldHVybiBgQ2xpbmljYWxJbXByZXNzaW9uP2VuY291bnRlcj0keygwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHJlc291cmNlLmVuY291bnRlcil9YDsKICB9IGVsc2UgewogICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHJlc291cmNlIHR5cGUiKTsKICB9Cn0KdmFyIHNlbGZSZXBvcnRlZEhpc3RvcnkgPSB7CiAgIkJsb29kIGNsb3RzIjogewogICAgY29kaW5nOiBbCiAgICAgIHsKICAgICAgICBjb2RlOiAiSTc0LjkiLAogICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCIsCiAgICAgICAgZGlzcGxheTogIkVtYm9saXNtIGFuZCB0aHJvbWJvc2lzIG9mIHVuc3BlY2lmaWVkIGFydGVyeSIKICAgICAgfQogICAgXQogIH0sCiAgU3Ryb2tlOiB7CiAgICBjb2Rpbmc6IFsKICAgICAgewogICAgICAgIGNvZGU6ICJJNjMuOSIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiQ2VyZWJyYWwgaW5mYXJjdGlvbiwgdW5zcGVjaWZpZWQiCiAgICAgIH0KICAgIF0KICB9LAogICJCcmVhc3QgY2FuY2VyIjogewogICAgY29kaW5nOiBbCiAgICAgIHsKICAgICAgICBjb2RlOiAiRDA1LjEwIiwKICAgICAgICBzeXN0ZW06ICJodHRwOi8vaGw3Lm9yZy9maGlyL3NpZC9pY2QtMTAiLAogICAgICAgIGRpc3BsYXk6ICJJbnRyYWR1Y3RhbCBjYXJjaW5vbWEgaW4gc2l0dSBvZiB1bnNwZWNpZmllZCBicmVhc3QiCiAgICAgIH0KICAgIF0KICB9LAogICJFbmRvbWV0cmlhbCBjYW5jZXIiOiB7CiAgICBjb2Rpbmc6IFsKICAgICAgewogICAgICAgIGNvZGU6ICJDNTQuMSIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiTWFsaWduYW50IG5lb3BsYXNtIG9mIGVuZG9tZXRyaXVtIgogICAgICB9CiAgICBdCiAgfSwKICAiSXJyZWd1bGFyIGJsZWVkaW5nIjogewogICAgY29kaW5nOiBbCiAgICAgIHsKICAgICAgICBjb2RlOiAiTjkyLjEiLAogICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCIsCiAgICAgICAgZGlzcGxheTogIkV4Y2Vzc2l2ZSBhbmQgZnJlcXVlbnQgbWVuc3RydWF0aW9uIHdpdGggaXJyZWd1bGFyIGN5Y2xlIgogICAgICB9CiAgICBdCiAgfSwKICAiQk1JID4gMzAiOiB7CiAgICBjb2Rpbmc6IFsKICAgICAgewogICAgICAgIGNvZGU6ICJFNjYuOSIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiT2Jlc2l0eSwgdW5zcGVjaWZpZWQiCiAgICAgIH0KICAgIF0KICB9Cn07CgovLyBzcmMvYm90cy9jb3JlL29ic2VydmF0aW9uLXV0aWxzLnRzCmZ1bmN0aW9uIGNhbGN1bGF0ZUJNSShoZWlnaHQsIHdlaWdodCkgewogIGlmICghaGVpZ2h0Py52YWx1ZSB8fCAhd2VpZ2h0Py52YWx1ZSkgewogICAgdGhyb3cgbmV3IEVycm9yKCJBbGwgdmFsdWVzIG11c3QgYmUgcHJvdmlkZWQiKTsKICB9CiAgY29uc3QgaGVpZ2h0TSA9IGdldEhlaWdodEluTWV0ZXJzKGhlaWdodCk7CiAgY29uc3Qgd2VpZ2h0S2cgPSBnZXRXZWlnaHRJbktpbG9ncmFtcyh3ZWlnaHQpOwogIGNvbnN0IGJtaSA9IE1hdGgucm91bmQod2VpZ2h0S2cgLyBoZWlnaHRNICoqIDIgKiAxMCkgLyAxMDsKICByZXR1cm4gewogICAgdmFsdWU6IGJtaSwKICAgIHVuaXQ6ICJrZy9tXjIiCiAgfTsKfQpmdW5jdGlvbiBnZXRXZWlnaHRJbktpbG9ncmFtcyh3ZWlnaHQpIHsKICBpZiAoIXdlaWdodC51bml0KSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIHVuaXQgZGVmaW5lZCIpOwogIH0KICBjb25zdCB1bml0ID0gd2VpZ2h0LnVuaXQ7CiAgY29uc3Qgd2VpZ2h0VmFsID0gd2VpZ2h0LnZhbHVlOwogIHN3aXRjaCAodW5pdCkgewogICAgY2FzZSAibGIiOgogICAgICByZXR1cm4gd2VpZ2h0VmFsIC8gMi4yOwogICAgY2FzZSAia2ciOgogICAgICByZXR1cm4gd2VpZ2h0VmFsOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIHVuaXQuIFBsZWFzZSBwcm92aWRlIHdlaWdodCBpbiBvbmUgb2YgdGhlIGZvbGxvd2luZyB1bml0czogUG91bmRzIG9yIGtpbG9ncmFtcy4iKTsKICB9Cn0KZnVuY3Rpb24gZ2V0SGVpZ2h0SW5NZXRlcnMoaGVpZ2h0KSB7CiAgaWYgKCFoZWlnaHQudW5pdCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJObyB1bml0IGRlZmluZWQiKTsKICB9CiAgY29uc3QgdW5pdCA9IGhlaWdodC51bml0OwogIGNvbnN0IGhlaWdodFZhbCA9IGhlaWdodC52YWx1ZTsKICBzd2l0Y2ggKHVuaXQpIHsKICAgIGNhc2UgImluIjoKICAgICAgcmV0dXJuIGhlaWdodFZhbCAqIDIuNTQgLyAxMDA7CiAgICBjYXNlICJmdCI6CiAgICAgIHJldHVybiBoZWlnaHRWYWwgKiAxMiAqIDIuNTQgLyAxMDA7CiAgICBjYXNlICJjbSI6CiAgICAgIHJldHVybiBoZWlnaHRWYWwgLyAxMDA7CiAgICBjYXNlICJtIjoKICAgICAgcmV0dXJuIGhlaWdodFZhbDsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAiVW5rbm93biB1bml0LiBQbGVhc2UgcHJvdmlkZSBoZWlnaHQgaW4gb25lIG9mIHRoZSBmb2xsb3dpbmcgdW5pdHM6IEluY2hlcywgZmVldCwgY2VudGltZXRlcnMsIG9yIG1ldGVycy4iCiAgICAgICk7CiAgfQp9CgovLyBzcmMvYm90cy9jb3JlL2d5bmVjb2xvZ3ktZW5jb3VudGVyLW5vdGUudHMKYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihtZWRwbHVtLCBldmVudCkgewogIGNvbnN0IHJlc3BvbnNlID0gZXZlbnQuaW5wdXQ7CiAgY29uc3QgYW5zd2VycyA9ICgwLCBpbXBvcnRfY29yZTIuZ2V0UXVlc3Rpb25uYWlyZUFuc3dlcnMpKHJlc3BvbnNlKTsKICBjb25zdCBlbmNvdW50ZXIgPSBhd2FpdCBtZWRwbHVtLnJlYWRSZWZlcmVuY2UocmVzcG9uc2UuZW5jb3VudGVyKTsKICBjb25zdCB1c2VyID0gbWVkcGx1bS5nZXRQcm9maWxlKCk7CiAgaWYgKCFhbnN3ZXJzWyJyZWFzb24tZm9yLXZpc2l0Il0/LnZhbHVlQ29kaW5nKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk11c3QgcHJvdmlkZSBhIHJlYXNvbiBmb3IgdGhlIHZpc2l0Iik7CiAgfQogIGNvbnN0IGRhdGUgPSBhbnN3ZXJzWyJkYXRlIl0udmFsdWVEYXRlVGltZTsKICBjb25zdCBvYnNlcnZhdGlvbkRhdGEgPSB7CiAgICBsYXN0UGVyaW9kOiBhbnN3ZXJzWyJsYXN0LXBlcmlvZCJdLAogICAgY29udHJhY2VwdGlvbjogYW5zd2Vyc1siY29udHJhY2VwdGlvbiJdLAogICAgbGFzdE1hbW1vZ3JhbTogYW5zd2Vyc1sibWFtbW9ncmFtIl0sCiAgICBzbW9raW5nU3RhdHVzOiBhbnN3ZXJzWyJzbW9raW5nIl0sCiAgICBkcnVnVXNlOiBhbnN3ZXJzWyJkcnVncyJdLAogICAgaG91c2luZ1N0YXR1czogYW5zd2Vyc1siaG91c2luZyJdLAogICAgaGVpZ2h0OiBhbnN3ZXJzWyJoZWlnaHQiXSwKICAgIHdlaWdodDogYW5zd2Vyc1sid2VpZ2h0Il0sCiAgICBzeXN0b2xpYzogYW5zd2Vyc1sic3lzdG9saWMiXSwKICAgIGRpYXN0b2xpYzogYW5zd2Vyc1siZGlhc3RvbGljIl0KICB9OwogIGlmIChvYnNlcnZhdGlvbkRhdGEuaGVpZ2h0ICYmIG9ic2VydmF0aW9uRGF0YS53ZWlnaHQpIHsKICAgIG9ic2VydmF0aW9uRGF0YS5ibWkgPSBjYWxjdWxhdGVCTUkob2JzZXJ2YXRpb25EYXRhLmhlaWdodC52YWx1ZVF1YW50aXR5LCBvYnNlcnZhdGlvbkRhdGEud2VpZ2h0LnZhbHVlUXVhbnRpdHkpOwogIH0KICBjb25zdCBhZGRUb1Byb2JsZW1MaXN0ID0gYW5zd2Vyc1sicHJvYmxlbS1saXN0Il0/LnZhbHVlQm9vbGVhbiA/PyBmYWxzZTsKICBjb25zdCBwYXJ0aWFsQ29uZGl0aW9uID0gewogICAgcmVzb3VyY2VUeXBlOiAiQ29uZGl0aW9uIiwKICAgIGNvZGU6IGFuc3dlcnNbInJlYXNvbi1mb3ItdmlzaXQiXS52YWx1ZUNvZGluZwogIH07CiAgY29uc3Qgbm90ZSA9IGFuc3dlcnNbImFzc2Vzc21lbnQiXT8udmFsdWVTdHJpbmc7CiAgY29uc3Qgb2JzZXJ2YXRpb25zID0gY3JlYXRlT2JzZXJ2YXRpb25zKG9ic2VydmF0aW9uRGF0YSwgZ3luZWNvbG9neUNvZGVzLCBlbmNvdW50ZXIsIHVzZXIsIHJlc3BvbnNlLCBkYXRlKTsKICBjb25zdCBjb25kaXRpb25zID0gY3JlYXRlQ29uZGl0aW9ucyhwYXJ0aWFsQ29uZGl0aW9uLCBlbmNvdW50ZXIsIHVzZXIsIGFkZFRvUHJvYmxlbUxpc3QpOwogIGNvbnN0IGNsaW5pY2FsSW1wcmVzc2lvbnMgPSBjcmVhdGVDbGluaWNhbEltcHJlc3Npb24oZW5jb3VudGVyLCB1c2VyLCBub3RlKTsKICBjb25zdCByZXNvdXJjZXMgPSBbLi4ub2JzZXJ2YXRpb25zLCAuLi5jb25kaXRpb25zXTsKICBpZiAoY2xpbmljYWxJbXByZXNzaW9ucykgewogICAgcmVzb3VyY2VzLnB1c2goY2xpbmljYWxJbXByZXNzaW9ucyk7CiAgfQogIGNvbnN0IGJ1bmRsZSA9IGNyZWF0ZUJ1bmRsZShyZXNvdXJjZXMpOwogIGNvbnN0IHJlc3BvbnNlQnVuZGxlID0gYXdhaXQgbWVkcGx1bS5leGVjdXRlQmF0Y2goYnVuZGxlKTsKICByZXR1cm4gcmVzcG9uc2VCdW5kbGU7Cn0KdmFyIGd5bmVjb2xvZ3lDb2RlcyA9IHsKICBsYXN0UGVyaW9kOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICI4NjY1LTIiLCBzeXN0ZW06IGltcG9ydF9jb3JlMi5MT0lOQywgZGlzcGxheTogIkxhc3QgbWVuc3RydWFsIHBlcmlvZCBzdGFydCBkYXRlIiB9XQogIH0sCiAgY29udHJhY2VwdGlvbjogewogICAgY29kaW5nOiBbeyBjb2RlOiAiODY1OS01Iiwgc3lzdGVtOiBpbXBvcnRfY29yZTIuTE9JTkMsIGRpc3BsYXk6ICJCaXJ0aCBjb250cm9sIG1ldGhvZCAtIFJlcG9ydGVkIiB9XQogIH0sCiAgbGFzdE1hbW1vZ3JhbTogewogICAgY29kaW5nOiBbeyBjb2RlOiAiNDI5NzM2MDA4Iiwgc3lzdGVtOiBpbXBvcnRfY29yZTIuU05PTUVELCBkaXNwbGF5OiAiRGF0ZSBvZiBsYXN0IG1hbW1vZ3JhbSIgfV0KICB9LAogIHNtb2tpbmdTdGF0dXM6IHsKICAgIGNvZGluZzogW3sgY29kZTogIjcyMTY2LTIiLCBzeXN0ZW06IGltcG9ydF9jb3JlMi5MT0lOQywgZGlzcGxheTogIlRvYmFjY28gc21va2luZyBzdGF0dXMiIH1dCiAgfSwKICBkcnVnVXNlOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICI3NDIwNC05Iiwgc3lzdGVtOiBpbXBvcnRfY29yZTIuTE9JTkMsIGRpc3BsYXk6ICJEcnVnIHVzZSIgfV0KICB9LAogIGhvdXNpbmdTdGF0dXM6IHsKICAgIGNvZGluZzogW3sgY29kZTogIjcxODAyLTMiLCBzeXN0ZW06IGltcG9ydF9jb3JlMi5MT0lOQywgZGlzcGxheTogIkhvdXNpbmcgc3RhdHVzIiB9XQogIH0sCiAgaGVpZ2h0OiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICI4MzAyLTIiLCBzeXN0ZW06IGltcG9ydF9jb3JlMi5MT0lOQywgZGlzcGxheTogIkJvZHkgaGVpZ2h0IiB9XQogIH0sCiAgd2VpZ2h0OiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICIyOTQ2My03Iiwgc3lzdGVtOiBpbXBvcnRfY29yZTIuTE9JTkMsIGRpc3BsYXk6ICJCb2R5IHdlaWdodCIgfV0KICB9LAogIGJsb29kUHJlc3N1cmU6IHsKICAgIGNvZGluZzogW3sgY29kZTogIjM1MDk0LTIiLCBzeXN0ZW06IGltcG9ydF9jb3JlMi5MT0lOQywgZGlzcGxheTogIkJsb29kIHByZXNzdXJlIHBhbmVsIiB9XQogIH0sCiAgYm1pOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICIzOTE1Ni01Iiwgc3lzdGVtOiBpbXBvcnRfY29yZTIuTE9JTkMsIGRpc3BsYXk6ICJCb2R5IE1hc3MgSW5kZXggKEJNSSkiIH1dCiAgfQp9OwovLyBBbm5vdGF0ZSB0aGUgQ29tbW9uSlMgZXhwb3J0IG5hbWVzIGZvciBFU00gaW1wb3J0IGluIG5vZGU6CjAgJiYgKG1vZHVsZS5leHBvcnRzID0gewogIGhhbmRsZXIKfSk7Ck9iamVjdC5hc3NpZ24oZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMpOwo="
      }
    },
    {
      "request": {
        "method": "PUT",
        "url": "$bot-gynecology-encounter-note-reference"
      },
      "resource": {
        "resourceType": "Bot",
        "id": "$bot-gynecology-encounter-note-id",
        "name": "gynecology-encounter-note",
        "runtimeVersion": "awslambda",
        "sourceCode": {
          "contentType": "text/typescript",
          "url": "urn:uuid:35870bee-7d1f-4a93-9e5a-53a9e7ec0e20"
        },
        "executableCode": {
          "contentType": "text/javascript",
          "url": "urn:uuid:2304998d-2ebb-4738-976c-8ba983d7d727"
        }
      }
    },
    {
      "request": {
        "url": "Subscription",
        "method": "POST",
        "ifNoneExist": "url=$bot-gynecology-encounter-note-reference"
      },
      "resource": {
        "resourceType": "Subscription",
        "status": "active",
        "reason": "gynecology-encounter-note",
        "channel": {
          "endpoint": "$bot-gynecology-encounter-note-reference",
          "type": "rest-hook"
        },
        "criteria": "QuestionnaireResponse?questionnaire=$gynecology-visit"
      }
    }
  ]
}